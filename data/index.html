<!-- XREG_START -->
<!--
 * AI_SUMMARY: Alternator Regulator Project - This file is the html for the interface, served by the ESP32 to a browser.  This is mostly HTML, only some minimal embedded JS.  Full JS and CSS files are separate.
 * AI_PURPOSE: Realtime control of GPIO (settings always have echos) and viewing of sensor data and calculated values.  
 * AI_INPUTS: Payloads from the ESP32.  Server-Sent Events via /events endpoint
 * AI_OUTPUTS: Values submitted back to ESP32 via HTTP GET/POST requests to various endpoints
 * AI_DEPENDENCIES: 
 * AI_RISKS: Variable naming is inconsisent, need to be careful not to assume consistent patterns
 * AI_OPTIMIZE: 
 * CRITICAL_INSTRUCTION_FOR_AI:: When adding new code, try to first use or modify existing code whenever possible, to avoid bloat. When impossible, always mimick my style and coding patterns. If you have a performance improvement idea, tell me. When giving me new code, I prefer complete copy and paste functions when they are short, or for you to give step by step instructions for me to edit if function is long, to conserve tokens. Always specify which option you chose.  Never re-write the entire file, this just wastes my tokens.

 */-->
<!-- 
 // X Engineering Alternator Regulator
//     Copyright (C) 2025  Mark Nickerson

//     This program is free software: you can redistribute it and/or modify
//     it under the terms of the GNU General Public License as published by
//     the Free Software Foundation, either version 3 of the License, or
//     (at your option) any later version.

//     This program is distributed in the hope that it will be useful,
//     but WITHOUT ANY WARRANTY; without even the implied warranty of
//     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//     GNU General Public License for more details.

//  See <https://www.gnu.org/licenses/> for GNU General Public License

// Contact me at mark@xengineering.net

//By using this device, you agree to XEngineering’s Terms and Conditions:
// https://xengineering.net/terms-and-conditions/ -->

<!DOCTYPE HTML>

<html>

<head>
  <meta charset="utf-8" />
  <title>X Engineering Alternator Regulator</title>
  <link rel="stylesheet" href="styles.css">
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <link href="/uPlot.min.css" rel="stylesheet" />
  <!-- Link to my separate javascript file -->
  <script src="script.js"></script>
  <!-- Link to uPlot javascript file -->
  <script src="/uPlot.iife.min.js"> </script>

</head>

<body><iframe name="hidden-form" style="display:none"></iframe>
  <h2>X Engineering Alternator Regulator</h2>

  <div class="permanent-header">
    <!-- Tier 1: Sensor readings that flow horizontally first, then wrap -->
    <div class="sensor-readings-tier">
      <div class="reading-pair">
        <div class="reading-item">
          <span class="reading-label">Battery</span>
          <span class="reading-value"><span id="header-voltage">-</span>V</span>
        </div>
        <div class="reading-item">
          <span class="reading-label">Charge</span>
          <span class="reading-value"><span id="header-soc">-</span>%</span>
        </div>
      </div>

      <div class="reading-pair">
        <div class="reading-item">
          <span class="reading-label">Alternator Current</span>
          <span class="reading-value"><span id="header-alt-current">-</span>A</span>
        </div>
        <div class="reading-item">
          <span class="reading-label">Battery Current</span>
          <span class="reading-value"><span id="header-batt-current">-</span>A</span>
        </div>
      </div>

      <div class="reading-pair">
        <div class="reading-item">
          <span class="reading-label">Alt Temp</span>
          <span class="reading-value"><span id="header-alt-temp">-</span>°F</span>
        </div>

        <div class="reading-item">
          <span class="reading-label">Engine</span>
          <span class="reading-value"><span id="header-rpm">-</span> RPM</span>
        </div>
      </div>

      <div class="reading-pair">
        <div class="reading-item">
          <span class="reading-label">Field</span>
          <span class="reading-value field-status-inactive" id="field-status">?</span>
        </div>
      </div>

    </div>

    <!-- Tier 2: Settings Access (full width underneath readings) -->
    <div id="settings-access-section" class="settings-access-tier">
      <div id="lock-status">Settings are Locked</div>
      <div class="password-form-wrapper">
        <form action="/get" method="GET" target="hidden-form" onsubmit="setAdminPassword(); return false;">
          <input type="hidden" name="dummy" value="1" />
          <div class="password-form">
            <div class="password-input-group">
              <input type="password" id="admin_password" name="admin_password" placeholder="Enter password"
                autocomplete="current-password" class="password-input" />
              <input type="submit" id="admin_password_set" value="Unlock" class="btn-primary" />
              <div class="show-checkbox-container">
                <input type="checkbox" class="show-checkbox" onclick="togglePassword('admin_password')">
                <label class="show-label">Show</label>
              </div>
            </div>
          </div>
          <div id="admin_password_msg"></div>
        </form>
      </div>
    </div>

    <!-- Tier 3: Alternator control (always centered and visible) -->
    <div class="alternator-control-tier">
      <div class="alternator-control">
        <span class="control-label">Alternator Enable</span>
        <form action="/get" method="GET" target="hidden-form">
          <input type="hidden" name="password" class="password_field">
          <label class="switch">
            <input id="header-alternator-enable" type="checkbox"
              onchange="if(handleAlternatorToggle(this)) { this.form.submit(); submitMessage(); }" />
            <span class="slider"></span>
          </label>
          <input id="OnOff" name="OnOff" type="number" value="" style="display:none;" />
        </form>
      </div>
    </div>

  </div>

  <!-- Main Tab Navigation -->
  <div class="main-tabs">
    <button class="main-tab" onclick="showMainTab('livedata')">Live Data</button>
    <button class="main-tab" onclick="showMainTab('settings')">Settings</button>
    <button class="main-tab" onclick="showMainTab('plots')">Plots</button>
    <button class="main-tab" onclick="showMainTab('console')">Console</button>
    <button class="main-tab" onclick="showMainTab('about')">About</button>
    <button class="main-tab" onclick="showMainTab('community')">Community</button>
  </div>

  <div id="settings" class="tab-content">
    <!-- Settings Sub-tabs -->
    <div class="sub-tabs">
      <button class="sub-tab active" onclick="showSubTab('settings', 'alternator')">Alternator</button>
      <button class="sub-tab" onclick="showSubTab('settings', 'pidtemp')">PID Temp Optimizer</button>
      <button class="sub-tab" onclick="showSubTab('settings', 'battery')">Battery</button>
      <button class="sub-tab" onclick="showSubTab('settings', 'weather')">Weather Mode</button>
      <button class="sub-tab" onclick="showSubTab('settings', 'alarms')">Alarms</button>
      <button class="sub-tab" onclick="showSubTab('settings', 'batterymonitor')">Battery Monitor</button>
      <button class="sub-tab" onclick="showSubTab('settings', 'thermistor')">Thermistor</button>
      <button class="sub-tab" onclick="showSubTab('settings', 'system')">System</button>
      <button class="sub-tab" onclick="showSubTab('settings', 'softwareupdate')">Software Update</button>

    </div>

    <div id="settings-section" class="locked">
      <div class="settings-grid">

        <!-- Alternator Settings Sub-tab -->
        <div id="settings-alternator" class="sub-tab-content active">
          <div class="settings-card">
            <div class="section-title">Alternator</div>

            <hr />
            <div class="form-row">
              <div class="form-label">Target Alternator Output (Normal) (A) (<span id="TargetAmps_echo">?</span>):
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="TargetAmps" type="number" step="1" min="0" max="500" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label">Target Alternator Output (Low) (A) (<span id="TargetAmpL_echo">?</span>):</div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="TargetAmpL" type="number" step="1" min="0" max="500" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label">Target Alternator Output (<span id="HiLow_echo">?</span>):</div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <span class="toggle-label">Low</span>
                  <label class="switch">
                    <input id="HiLow_checkbox" type="checkbox" onchange="if(handleUserToggle('HiLow_checkbox', 'HiLow', 'HiLow')) { this.form.submit();
               submitMessage(); }" />
                    <span class="slider round"></span>
                  </label>
                  <span class="toggle-label">Normal</span>
                  <input id="HiLow" name="HiLow" type="number" value="" style="display:none;" />
                </form>
              </div>
            </div>



            <hr />
            <div class="form-row">
              <div class="form-label">Manual Field Enable (<span id="ManualFieldToggle_echo">?</span>):</div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <span class="toggle-label">Off</span>
                  <label class="switch">
                    <input id="ManualFieldToggle_checkbox" type="checkbox"
                      onchange="if(handleUserToggle('ManualFieldToggle_checkbox', 'ManualFieldToggle', 'ManualFieldToggle')) { this.form.submit(); submitMessage(); }" />
                    <span class="slider round"></span>
                  </label>
                  <span class="toggle-label">On</span>
                  <input id="ManualFieldToggle" name="ManualFieldToggle" type="number" value="" style="display:none;" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label">Manual Field PWM (%) (<span id="ManualDutyTarget_echo">?</span>):</div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="ManualDutyTarget" type="number" step="1" min="0" max="100" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>


            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Min Field (%) (<span id="MinDuty_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Engine Speed may register better if min field is kept >15% or so, but (very
                    important!) this value should not produce any alternator output even at max battery voltage, or many
                    controls will become confused. If in doubt, set to zero, and the only penalty is that tachometer
                    will
                    only be visible while charging.</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="MinDuty" type="number" step="1" min="0" max="100" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>


            <hr />
            <div class="form-row">
              <div class="form-label">Max Field (%) (<span id="MaxDuty_echo">?</span>):</div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="MaxDuty" type="number" step="1" min="0" max="100" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Field Resistance (Ohms) (<span id="FieldResistance_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Only affects Field Amps calc, not important</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="FieldResistance" type="number" step="0.01" min="0.01" max="100" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label">Field Switching Freq (hz) (<span id="SwitchingFrequency_echo">?</span>):</div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="SwitchingFrequency" type="number" step="1" min="50" max="19500" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>


            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Field Adj Step (%) (<span id="dutyStep_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Controls response rate in an emergency overheating- higher = faster
                    response</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="dutyStep" type="number" step="0.001" min="0" max="100" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>


            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Amp Target Source (<span id="AmpSrc_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Controller will use this selection for feedback</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <select name="AmpSrc">
                    <option value="0">Alt Hall Effect Sensor</option>
                    <option value="1">Battery Shunt</option>
                    <option value="2">NMEA2K Batt</option>
                    <option value="3">NMEA2K Alt</option>
                    <option value="4">NMEA0183 Batt</option>
                    <option value="5">NMEA0183 Alt</option>
                    <option value="6">Victron Batt</option>
                    <option value="7">Other</option>
                  </select>
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>


            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Alternator Temp Limit (F) (<span id="TemperatureLimitF_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">30F offset from measured temp to true max temp not uncommon; set this lower
                    accordingly</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="TemperatureLimitF" type="number" step="1" min="0" max="350" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Winding Temp Offset (°F) (<span id="WindingTempOffset_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">How much hotter windings are than case temperature. Typical: 40-60°F</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="WindingTempOffset" type="number" step="0.1" min="0" max="100" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Ignore Alt Temp (<span id="IgnoreTemperature_echo">0</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">For emergency use, if temp sensor is bad</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <span class="toggle-label">No</span>
                  <label class="switch">
                    <input id="IgnoreTemperature_checkbox" type="checkbox"
                      onchange="if(handleUserToggle('IgnoreTemperature_checkbox', 'IgnoreTemperature', 'IgnoreTemperature')) { this.form.submit(); submitMessage(); }" />
                    <span class="slider round"></span>
                  </label>
                  <span class="toggle-label">Yes</span>
                  <input id="IgnoreTemperature" name="IgnoreTemperature" type="number" value="" style="display:none;" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label">Invert Alternator Amps (<span id="InvertAltAmps_echo">?</span>):</div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <span class="toggle-label">No</span>
                  <label class="switch">
                    <input id="InvertAltAmps_checkbox" type="checkbox"
                      onchange="if(handleUserToggle('InvertAltAmps_checkbox', 'InvertAltAmps', 'InvertAltAmps')) { this.form.submit(); submitMessage(); }" />
                    <span class="slider round"></span>
                  </label>
                  <span class="toggle-label">Yes</span>
                  <input id="InvertAltAmps" name="InvertAltAmps" type="number" value="" style="display:none;" />
                </form>
              </div>
            </div>
            <hr />
            <div class="form-row">
              <div class="form-label">Alternator Current Offset (A) (<span id="AlternatorCOffset_echo">?</span>):</div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="AlternatorCOffset" type="number" step="0.01" min="-100" max="100" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>


            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Current Threshold (A) (<span id="CurrentThreshold_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Below this, the Alternator is assumed OFF. Affects many altenator
                    calcs.</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <input name="CurrentThreshold" type="number" step="0.01" min="0.01" max="20" />
                  <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Set Alternator Life Manually (%) (<span id="ManualLifePercentage_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">This will adjust life for brushes, bearings, insulation all together, meant
                    for zero-ing all together</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field" />
                  <input name="ManualLifePercentage" type="number" step="1" min="0" max="100" />
                  <input onclick="submitMessage.call(this)" type="submit" value="Set" class="btn-primary" />
                </form>
              </div>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Alternator Auto-Zero (<span id="AutoAltCurrentZero_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Automatically zeros alternator current reading every hour and when
                    temperature
                    changes 20°F.</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <span class="toggle-label">Off</span>
                  <label class="switch">
                    <input id="AutoAltCurrentZero_checkbox" type="checkbox"
                      onchange="if(handleUserToggle('AutoAltCurrentZero_checkbox', 'AutoAltCurrentZero', 'AutoAltCurrentZero')) { this.form.submit(); submitMessage(); }" />
                    <span class="slider round"></span>
                  </label>
                  <span class="toggle-label">On</span>
                  <input id="AutoAltCurrentZero" name="AutoAltCurrentZero" type="number" value=""
                    style="display:none;" />
                  <input type="hidden" name="ResetDynamicAltZero" id="ResetDynamicAltZero" value="0" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetDynamicAltZero')"
                    id="ResetDynamicAltZero_button">Reset Zero</button>
                </form>
              </div>
            </div>

          </div> <!-- CLOSE Alternator settings-card -->
        </div>
      </div>




      <!-- PID Temp Optimizer Settings Sub-tab -->
      <div id="settings-pidtemp" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">PID Temperature Optimizer</div>

          <!-- Learning System Status Section -->
          <div class="learning-section">
            <div class="section-header">
              ⚡ Learning System Status
              <span id="learning-status-indicator" class="learning-status learning-status-inactive">⚪ Inactive</span>
            </div>

            <hr />
            <div class="form-row">
              <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
                <span>Learning Mode Enable (<span id="LearningMode_echo">?</span>):</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Master enable - Turns entire learning system on/off. When off, uses basic
                    field control</span>
                </span>
              </div>
              <div class="form-input">
                <form action="/get" method="GET" target="hidden-form">
                  <input type="hidden" name="password" class="password_field">
                  <span class="toggle-label">Off</span>
                  <label class="switch">
                    <input id="LearningMode_checkbox" type="checkbox" onchange="if(handleUserToggle('LearningMode_checkbox', 'LearningMode', 'LearningMode')) { 
                      updateLearningTableEditability(this.checked); 
                      this.form.submit(); 
                      submitMessage(); 
                  }" />
                    <span class="slider round"></span>
                  </label>
                  <span class="toggle-label">On</span>
                  <input id="LearningMode" name="LearningMode" type="number" value="" style="display:none;" />
                </form>
              </div>
            </div>

            <div class="learning-table-container">
              <form action="/get" method="GET" target="hidden-form" id="learning-table-form">
                <input type="hidden" name="password" class="password_field">

                <table class="learning-table">
                  <thead>
                    <tr>
                      <th>RPM</th>
                      <th>Current Limit (A)</th>
                      <th>Overheats</th>
                      <th>Safe Hours</th>
                    </tr>
                  </thead>
                  <tbody id="learning-table-body">
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints0_input" name="rpmTableRPMPoints0" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable0_input" name="rpmCurrentTable0" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount0_display">?</span></td>
                      <td><span id="safeHours0_display">?</span>h</td>
                    </tr>
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints1_input" name="rpmTableRPMPoints1" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable1_input" name="rpmCurrentTable1" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount1_display">?</span></td>
                      <td><span id="safeHours1_display">?</span>h</td>
                    </tr>
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints2_input" name="rpmTableRPMPoints2" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable2_input" name="rpmCurrentTable2" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount2_display">?</span></td>
                      <td><span id="safeHours2_display">?</span>h</td>
                    </tr>
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints3_input" name="rpmTableRPMPoints3" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable3_input" name="rpmCurrentTable3" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount3_display">?</span></td>
                      <td><span id="safeHours3_display">?</span>h</td>
                    </tr>
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints4_input" name="rpmTableRPMPoints4" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable4_input" name="rpmCurrentTable4" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount4_display">?</span></td>
                      <td><span id="safeHours4_display">?</span>h</td>
                    </tr>
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints5_input" name="rpmTableRPMPoints5" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable5_input" name="rpmCurrentTable5" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount5_display">?</span></td>
                      <td><span id="safeHours5_display">?</span>h</td>
                    </tr>
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints6_input" name="rpmTableRPMPoints6" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable6_input" name="rpmCurrentTable6" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount6_display">?</span></td>
                      <td><span id="safeHours6_display">?</span>h</td>
                    </tr>
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints7_input" name="rpmTableRPMPoints7" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable7_input" name="rpmCurrentTable7" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount7_display">?</span></td>
                      <td><span id="safeHours7_display">?</span>h</td>
                    </tr>
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints8_input" name="rpmTableRPMPoints8" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable8_input" name="rpmCurrentTable8" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount8_display">?</span></td>
                      <td><span id="safeHours8_display">?</span>h</td>
                    </tr>
                    <tr class="learning-table-row">
                      <td><input id="rpmTableRPMPoints9_input" name="rpmTableRPMPoints9" type="number" min="0"
                          max="10000" step="10"></td>
                      <td><input id="rpmCurrentTable9_input" name="rpmCurrentTable9" type="number" min="0" max="500"
                          step="0.1"></td>
                      <td><span id="overheatCount9_display">?</span></td>
                      <td><span id="safeHours9_display">?</span>h</td>
                    </tr>
                  </tbody>
                </table>

                <div id="learning-table-button-container" style="margin-top: 15px; text-align: center;">
                  <input type="submit" value="Save Table" onclick="submitMessage()" class="btn-save-table"
                    style="display: none;">
                </div>


                <!-- Learning Status Info -->
                <div class="learning-info-grid">
                  <div class="learning-info-item">
                    <span class="learning-info-label">Current RPM Index:</span>
                    <span class="learning-info-value"><span id="currentRPMTableIndex_display">0</span></span>
                  </div>
                  <div class="learning-info-item">
                    <span class="learning-info-label">PID Initialized:</span>
                    <span class="learning-info-value"><span id="pidInitialized_display">No</span></span>
                  </div>
                </div>
            </div>

            <hr />

            <!-- Learning Management Buttons -->
            <div class="form-input">
              <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="password" class="password_field">
                  <input type="hidden" name="ResetLearningTable" value="1">
                  <input onclick="return handleResetLearningTable();" type="submit" value="Reset Table"
                    class="btn-primary" />
                </form>

                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="password" class="password_field">
                  <input type="hidden" name="ClearOverheatHistory" value="1">
                  <input onclick="submitMessage();" type="submit" value="Clear Overheats" class="btn-primary" />
                </form>
              </div>
            </div>
          </div> <!-- Close learning-table-container -->

          <hr />

          <!-- Learning Control Section -->
          <div class="section-title">Learning Control</div>



          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Pause Learning (<span id="LearningPaused_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Pause learning - Stops learning updates but keeps using current table</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="LearningPaused_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('LearningPaused_checkbox', 'LearningPaused', 'LearningPaused')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="LearningPaused" name="LearningPaused" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Test Mode (<span id="LearningDryRunMode_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Learning calculates but doesn't actually apply changes</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="LearningDryRunMode_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('LearningDryRunMode_checkbox', 'LearningDryRunMode', 'LearningDryRunMode')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="LearningDryRunMode" name="LearningDryRunMode" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />


          <!-- Learning Configuration Section -->
          <div class="section-title">Learning Configuration</div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Alternator Nominal Amps (<span id="AlternatorNominalAmps_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Alternator rating - Used to calculate penalty amounts during
                  overheating</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="AlternatorNominalAmps" type="number" step="1" min="1" max="5000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Learning Up Step (A) (<span id="LearningUpStep_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Setpoint increase amount (amps) after extended safe operation. Conservative:
                  0.5A, Aggressive: 2.0A. Larger steps learn faster but risk overshooting thermal limits.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="LearningUpStep" type="number" step="0.1" min="0" max="100" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Learning Down Step (A) (<span id="LearningDownStep_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Current decrease (amps) after an overheating event. Should be larger than
                  UpStep for safety. Typical: 2-5A to provide some margin.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="LearningDownStep" type="number" step="0.1" min="0" max="100" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Min Learning Interval (s) (<span id="MinLearningInterval_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Minimum time between ALL learning updates. Prevents learning
                  storms from sensor noise</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="MinLearningInterval" type="number" step="1" min="1" max="600000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Safe Time Required (s) (<span id="SafeOperationThreshold_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">How long to run safely before allowing current increases.
                  Longer = more conservative</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="SafeOperationThreshold" type="number" step="1" min="1" max="40000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />

          <!-- PID Configuration Section -->
          <div class="section-title">PID Controller</div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>PID Kp (Proportional) (<span id="PidKp_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Immediate response to current error. Higher = faster correction but more
                  overshoot. Start with 0.5, increase if too slow, decrease if some conditions oscillate.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="PidKp" type="number" step="0.001" min="0" max="10000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>PID Ki (Integral) (<span id="PidKi_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Eliminates steady-state error over time. Higher = faster elimination of
                  offset
                  but may cause instability. Start with 0.1, increase slowly if needed.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="PidKi" type="number" step="0.001" min="0" max="10000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>PID Kd (Derivative) (<span id="PidKd_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Dampens rapid changes to reduce overshoot. Higher = more stability but
                  slower
                  response. Usually kept at 0.0 here.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="PidKd" type="number" step="0.001" min="0" max="10000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>PID Sample Time (ms) (<span id="PidSampleTime_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">How often the PID controller recalculates (milliseconds). Faster = more
                  responsive control but potentially less stable. Typical range: 50-200ms</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="PidSampleTime" type="number" step="1" min="1" max="500000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />

          <!-- Advanced Learning Options Section -->
          <div class="section-title">Advanced Learning Options</div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Learning Upward Enabled (<span id="LearningUpwardEnabled_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Allow increases - Permits increasing current limits during safe operation.
                  Disable for maximum conservative behavior</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="LearningUpwardEnabled_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('LearningUpwardEnabled_checkbox', 'LearningUpwardEnabled', 'LearningUpwardEnabled')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="LearningUpwardEnabled" name="LearningUpwardEnabled" type="number" value=""
                  style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Learning Downward Enabled (<span id="LearningDownwardEnabled_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Allow decreases - Permits decreasing current limits after overheats. Should
                  normally stay enabled for safety</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="LearningDownwardEnabled_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('LearningDownwardEnabled_checkbox', 'LearningDownwardEnabled', 'LearningDownwardEnabled')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="LearningDownwardEnabled" name="LearningDownwardEnabled" type="number" value=""
                  style="display:none;" />
              </form>
            </div>
          </div>
          <hr />
          <div class="form-row">
            <div class="form-label">Ignore Learning During Penalty (<span
                id="IgnoreLearningDuringPenalty_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="IgnoreLearningDuringPenalty_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('IgnoreLearningDuringPenalty_checkbox', 'IgnoreLearningDuringPenalty', 'IgnoreLearningDuringPenalty')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="IgnoreLearningDuringPenalty" name="IgnoreLearningDuringPenalty" type="number" value=""
                  style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Enable Neighbor Learning (<span id="EnableNeighborLearning_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Neighbor effects - When one RPM range overheats, also reduce adjacent ranges
                  because heat spreads</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="EnableNeighborLearning_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('EnableNeighborLearning_checkbox', 'EnableNeighborLearning', 'EnableNeighborLearning')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="EnableNeighborLearning" name="EnableNeighborLearning" type="number" value=""
                  style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Auto Save Learning Table (<span id="AutoSaveLearningTable_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Auto-save - Automatically save learned table to flash memory. Keeps learning
                  across power cycles</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="AutoSaveLearningTable_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('AutoSaveLearningTable_checkbox', 'AutoSaveLearningTable', 'AutoSaveLearningTable')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="AutoSaveLearningTable" name="AutoSaveLearningTable" type="number" value=""
                  style="display:none;" />
              </form>
            </div>
          </div>

          <hr />

          <!-- Debugging Section -->
          <div class="section-title">Debugging & Telemetry</div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Show Learning Debug Messages (<span id="ShowLearningDebugMessages_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Debug output - Show learning events in console. Useful for understanding
                  what
                  the system is doing</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="ShowLearningDebugMessages_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('ShowLearningDebugMessages_checkbox', 'ShowLearningDebugMessages', 'ShowLearningDebugMessages')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="ShowLearningDebugMessages" name="ShowLearningDebugMessages" type="number" value=""
                  style="display:none;" />
              </form>
            </div>
          </div>

          <!-- Replace all existing learning-info-grid sections with this single one -->
          <div class="learning-info-grid">
            <!-- PID Control -->
            <div class="learning-info-item">
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  PID Input:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Current measured alternator output in amps</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="pidInput_display">?</span>A</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  PID Setpoint:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Target alternator output after all learning corrections</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="pidSetpoint_display">?</span>A</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  PID Output:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Duty cycle percentage calculated by PID controller</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="pidOutput_display">?</span>%</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  PID Error:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Difference between setpoint and input (setpoint - input)</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="pidError_display">?</span>A</span>
              </div>
            </div>

            <!-- Field Output -->
            <div class="learning-info-item">
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Field Voltage:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Calculated field voltage (duty cycle × battery voltage)</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="FieldVoltsID2">?</span>V</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Field Current:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Calculated field current (field voltage ÷ field resistance)</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="FieldAmpsID2">?</span>A</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Actual Duty Cycle:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Final duty cycle applied to field after all safety constraints</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="dutyCycleID2">?</span>%</span>
              </div>
            </div>

            <!-- Learning Status -->
            <div class="learning-info-item">
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Current RPM:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Engine RPM used for learning table lookup</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="RPMID2">?</span></span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Table Index:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Which learning table entry is active for current RPM</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="currentRPMTableIndex_display2">?</span></span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Learning Target:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Learned amperage limit from table for current RPM</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="learningTargetFromRPM_display">?</span>A</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Ambient Temp Correction:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Temperature-based correction applied to target amps</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="ambientTempCorrection_display">?</span>A</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Final Learning Target:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Target amps after all learning corrections applied</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="finalLearningTarget_display">?</span>A</span>
              </div>
            </div>

            <!-- Temperature & Safety -->
            <div class="learning-info-item">
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Current Temperature:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Alternator temperature from selected sensor</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="TempToUse_display">?</span>°F</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Penalty Timer:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Seconds remaining of overheat penalty</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="overheatingPenaltyTimer_display">?</span>s</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Penalty Reduction:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Amount being subtracted from target due to recent overheating</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="overheatingPenaltyAmps_display">?</span>A</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Settling Period:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Seconds after RPM change before learning resumes (prevents false
                      correlations during thermal lag)</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="LearningSettlingPeriod_display">?</span>s</span>
              </div>
            </div>

            <!-- Learning Statistics -->
            <div class="learning-info-item">
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Total Learning Events:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Total number of learning table updates performed</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="totalLearningEvents_display">?</span></span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Total Overheats:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Total number of overheat events across all RPM ranges</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="totalOverheats_display">?</span></span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Total Safe Hours:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Cumulative hours of safe operation across all RPM ranges</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="totalSafeHours_display">?</span>h</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Average Table Value:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Mean of all learning table entries</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="averageTableValue_display">?</span>A</span>
              </div>
              <div class="learning-info-value-pair">
                <span class="learning-info-label">
                  Time Since Last Overheat:
                  <span class="tooltip" onclick="this.classList.toggle('active')">
                    ℹ️
                    <span class="tooltip-box">Seconds since the most recent overheat in any RPM range</span>
                  </span>
                </span>
                <span class="learning-info-value"><span id="timeSinceLastOverheat_display">?</span>s</span>
              </div>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Learning Settling Period (s) (<span id="LearningSettlingPeriod_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Delay after RPM change before learning resumes. Prevents false correlations
                  during thermal lag as alternator adjusts to new speed.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="LearningSettlingPeriod" type="number" step="1" min="0" max="600" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>RPM Change Threshold (<span id="LearningRPMChangeThreshold_display">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Minimum RPM change to trigger settling period. Ignores small fluctuations to
                  avoid unnecessary learning delays.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="LearningRPMChangeThreshold" type="number" step="10" min="0" max="1000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Temperature Hysteresis (°F) (<span id="LearningTempHysteresis_display">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Temperature must drop this many degrees below limit before upward learning
                  resumes. Prevents oscillation at thermal threshold.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="LearningTempHysteresis" type="number" step="1" min="0" max="50" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Ambient Temp Baseline (<span id="AmbientTempBaseline_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Reference temperature - Baseline ambient temperature for correction
                  calculations. Typically 20°C</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="AmbientTempBaseline" type="number" step="1" min="-50" max="150" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Max Current Setpoint (<span id="MaxTableValue_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Maximum current limit any RPM range can learn. Safety ceiling to
                  prevent runaway learning</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="MaxTableValue" type="number" step="1" min="0" max="500000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Min Current Setpoint (<span id="MinTableValue_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Minimum current limit any RPM range can learn</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="MinTableValue" type="number" step="1" min="0" max="5000000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Max Penalty Percent (<span id="MaxPenaltyPercent_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Penalty severity - How much to reduce current during penalty (% of nominal).
                  Higher = harsher immediate response</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="MaxPenaltyPercent" type="number" step="1" min="0" max="100" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Max Penalty Duration (s) (<span id="MaxPenaltyDuration_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Penalty time - How long penalty lasts after overheat. Longer = more
                  conservative recovery time</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="MaxPenaltyDuration" type="number" step="1" min="0" max="360000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Neighbor Learning Factor (<span id="NeighborLearningFactor_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Neighbor influence - How much adjacent RPM ranges are affected (0.5 = 50%).
                  Higher = stronger thermal coupling assumed</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="NeighborLearningFactor" type="number" step="0.01" min="0" max="10000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Learning RPM Spacing (<span id="LearningRPMSpacing_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">RPM bin size - Width of each RPM learning range. Currently hardcoded but
                  this
                  setting exists for future use</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="LearningRPMSpacing" type="number" step="100" min="100" max="10000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Learning Table Save Interval (s) (<span id="LearningTableSaveInterval_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Save frequency - How often to save table to flash memory. More frequent =
                  less
                  learning loss on power failure</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="LearningTableSaveInterval" type="number" step="1" min="1" max="36000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Ambient Temp Correction Factor (A/degF) (<span
                  id="AmbientTempCorrectionFactor_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Current adjustment per degree of ambient temp
                  change. Higher = more temperature compensation</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="AmbientTempCorrectionFactor" type="number" step="0.01" min="-1000" max="1000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />

          <!-- System Overview -->
          <div class="section-title">How it works</div>
          <div
            style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--accent); margin: 10px 0;">
            <p style="margin: 0; line-height: 1.5; color: var(--text-dark);">
              This mode monitors alternator temperature while targeting the maximum allowable output per each engine
              speed.
              When overheating occurs, it permanently reduces the safe current limit for that speed, and temporarily
              applies an extra penalty to allow cooling down.
              During extended operation with no overheating, the system gradually increases output to maximize
              charging
              performance.
              The PID controller provides precise current regulation, while "neighbor learning" spreads thermal
              knowledge to adjacent speeds.
              Over time, your alternator learns its thermal limits for maximum output without damage.
            </p>
          </div>

        </div> <!-- Close settings-card -->
      </div> <!-- Close settings-pidtemp -->



      <!-- Weather Mode Settings Section -->
      <div id="settings-weather" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">Weather Mode</div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Weather Mode (<span id="weatherModeEnabled_echo">?</span>)</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">
                  Saves fuel, emissions, and alternator wear when UV forecast is optimistic for at least 2 of the next
                  3
                  days in your GPS location. Useful for solar-dominant systems.
                </span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="weatherModeEnabled_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('weatherModeEnabled_checkbox', 'weatherModeEnabled', 'weatherModeEnabled')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="weatherModeEnabled" name="weatherModeEnabled" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div>
            <button onclick="triggerWeatherUpdate()">Update Weather Now</button>
          </div>
          <hr />

          <hr />
          <div class="card">
            <p>Weather Data Valid? </p>
            <p class="reading"><span id="weatherDataValidID">0</span> </p>
          </div>

          <div class="card">
            <p>Predicted Solar Output Today</p>
            <p class="reading" id="solar-output-today-display">
              <span id="pKwHrToday_ID">0.00</span> kWh
            </p>
          </div>

          <div class="card">
            <p>Predicted Solar Output Tomorrow</p>
            <p class="reading" id="solar-output-tomorrow-display">
              <span id="pKwHrTomorrow_ID">0.00</span> kWh
            </p>
          </div>

          <div class="card">
            <p>Predicted Solar Output Day After Tomorrow</p>
            <p class="reading" id="solar-output-day2-display">
              <span id="pKwHr2days_ID">0.00</span> kWh
            </p>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Nominal Solar Array Power (W): (<span id="SolarWatts_echo">0</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">System-rated solar capacity, e.g. 600 for two 300W panels
                </span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="SolarWatts" type="number" step="1" min="0" max="999999999" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Solar Performance Ratio: (<span id="performanceRatio_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Accounts for losses, 0.75 typical, adjust to fit your system
                </span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="performanceRatio" type="number" step="0.01" min="0" max="99" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>High Solar UV Threshold (kWh): (<span id="UVThresholdHigh_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">if predicted solar output for at least 2 of next 3 days exceeds this value,
                  pause alternator output
                </span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="UVThresholdHigh" type="number" step="0.01" min="0" max="9999" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="card">
            <p>Active Mode: </p>
            <p class="reading"><span id="currentWeatherModeID">0</span> </p>
          </div>
          <hr />
          <div class="card">
            <p>UV Today: </p>
            <p class="reading"><span id="UVTodayID">0</span> </p>
          </div>
          <hr />
          <div class="card">
            <p>UV Tomorrow: </p>
            <p class="reading"><span id="UVTomorrowID">0</span> </p>
          </div>
          <hr />
          <div class="card">
            <p>UV Day2: </p>
            <p class="reading"><span id="UVDay2ID">0</span> </p>
          </div>

          <hr />

          <!-- System Overview -->
          <div class="section-title">How it works</div>
          <div
            style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--accent); margin: 10px 0;">
            <p style="margin: 0; line-height: 1.5; color: var(--text-dark);">
              Weather mode automatically fetches solar irradiance forecasts using your GPS coordinates and calculates
              expected solar panel output.
              When high solar conditions are predicted for two of the next three days, alternator charging is paused.
              Solar panel wattage and performance ratio settings allow accurate prediction of your solar energy
              production.
              This feature reduces fuel consumption and system wear when Mother Nature is planning to help.
            </p>
          </div>


        </div> <!-- CLOSE Weather settings-card -->
      </div>



      <!-- Thermistor Settings Sub-tab -->
      <div id="settings-thermistor" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">Thermistor</div>

          <hr />
          <div class="form-row">
            <div class="form-label">Temp Source (<span id="TempSource_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Digital (default)</span>
                <label class="switch">
                  <input id="TempSource_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('TempSource_checkbox', 'TempSource', 'TempSource')) { this.form.submit(); submitMessage(); }">
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">Thermistor</span>
                <input id="TempSource" name="TempSource" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Series Resistor R_fixed Ω (<span id="R_fixed_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="R_fixed" type="number" step="1" min="0" max="1000000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Thermistor Beta (<span id="Beta_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="Beta" type="number" step="1" min="0" max="100000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Reference Temp T0 °C (<span id="T0_C_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="T0_C" type="number" step="0.1" min="0" max="300" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

        </div> <!-- CLOSE Thermistor settings-card -->
      </div> <!-- End Thermistor Settings Sub-tab -->



      <!-- Battery Settings Sub-tab -->
      <div id="settings-battery" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">Battery</div>

          <hr />
          <div class="form-row">
            <div class="form-label">Bulk Voltage (<span id="BulkVoltage_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="BulkVoltage" type="number" step="0.01" min="1" max="70" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Bulk Completion Time (sec) (<span id="bulkCompleteTime_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="bulkCompleteTime" type="number" step="1" min="1" max="600" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Float Voltage (<span id="FloatVoltage_echo">?</span>):
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="FloatVoltage" type="number" step="0.01" min="1" max="70" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>



          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Float Duration (hrs) (<span id="FLOAT_DURATION_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Alternator will not target Bulk votage again for this long- 12hrs
                  typical</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="FLOAT_DURATION" type="number" step="0.01" min="0" max="999" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Force "Maintain Mode" (<span id="ForceFloat_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Targets 0 amps in/out of battery to offset active loads, nothign more</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="ForceFloat_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('ForceFloat_checkbox', 'ForceFloat', 'ForceFloat')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="ForceFloat" name="ForceFloat" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Battery Voltage Source (<span id="BatteryVoltageSource_echo">?</span>)</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">
                  Expect a temporary interruption in Battery Monitor accuracy after changing this
                </span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <select name="BatteryVoltageSource">
                  <option value="0">0 INA228</option>
                  <option value="1">1 ADS1115</option>
                  <option value="2">2 VictronVeDirect</option>
                  <option value="3">3 NMEA0183</option>
                  <option value="4">4 NMEA2K</option>
                </select>
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label">Invert Battery Amps (<span id="InvertBattAmps_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">No</span>
                <label class="switch">
                  <input id="InvertBattAmps_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('InvertBattAmps_checkbox', 'InvertBattAmps', 'InvertBattAmps')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">Yes</span>
                <input id="InvertBattAmps" name="InvertBattAmps" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Battery Current Offset (A) (<span id="BatteryCOffset_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="BatteryCOffset" type="number" step="0.01" min="-100" max="100" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>SOC Auto-Correction (<span id="AutoShuntGainCorrection_echo">0</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Automatically corrects battery current readings when full charge is
                  detected.
                  Only works with Battery Shunt (AmpSrc=1).</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="AutoShuntGainCorrection_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('AutoShuntGainCorrection_checkbox', 'AutoShuntGainCorrection', 'AutoShuntGainCorrection')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="AutoShuntGainCorrection" name="AutoShuntGainCorrection" type="number" value=""
                  style="display:none;" />
                <input type="hidden" name="ResetDynamicShuntGain" id="ResetDynamicShuntGain" value="0" />
                <button type="button" class="btn-secondary" onclick="resetParameter('ResetDynamicShuntGain')"
                  id="ResetDynamicShuntGain_button">Reset Factor</button>
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">SOC Gain Factor (Current Value):</div>
            <div class="form-input">
              <span id="DynamicShuntGainFactor_display"
                style="font-weight: bold; color: var(--accent); font-size: 14px;">?</span>
            </div>
          </div>

        </div> <!-- closes .settings-card for Battery -->
      </div>



      <!-- Alarms Settings Sub-tab -->
      <div id="settings-alarms" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">Alarm / Emergency</div>

          <hr />
          <div class="form-row">
            <div class="form-label">Alarm Enable (<span id="AlarmActivate_echo">0</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="AlarmActivate_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('AlarmActivate_checkbox', 'AlarmActivate', 'AlarmActivate')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">Armed</span>
                <input id="AlarmActivate" name="AlarmActivate" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">High Temp Alarm (F) (<span id="TempAlarm_echo">0</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="TempAlarm" type="number" step="1" min="0" max="350" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label">High Voltage Alarm (<span id="VoltageAlarmHigh_echo">0</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="VoltageAlarmHigh" type="number" step="0.1" min="0" max="70" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>
          <hr />

          <div class="form-row">
            <div class="form-label">Low Voltage Alarm (<span id="VoltageAlarmLow_echo">0</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="VoltageAlarmLow" type="number" step="0.1" min="0" max="70" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>
          <hr />
          <div class="form-row">
            <div class="form-label">High Current Alarm (Alternator) (A) (<span id="CurrentAlarmHigh_echo">0</span>):
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="CurrentAlarmHigh" type="number" step="1" min="0" max="1000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">High Current Alarm (Battery) (A) (<span
                id="MaximumAllowedBatteryAmps_echo">0</span>):
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="MaximumAllowedBatteryAmps" type="number" step="1" min="0" max="1000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Alarm Latch Mode (<span id="AlarmLatchEnabled_echo">0</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Momentary</span>
                <label class="switch">
                  <input id="AlarmLatchEnabled_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('AlarmLatchEnabled_checkbox', 'AlarmLatchEnabled', 'AlarmLatchEnabled')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">Latched</span>
                <input id="AlarmLatchEnabled" name="AlarmLatchEnabled" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <div class="form-row">
            <div class="form-label">Alarm Test (<span id="AlarmTest_echo">0</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form" onsubmit="return handleAlarmTest();">
                <input type="hidden" name="password" class="password_field">
                <input type="hidden" name="AlarmTest" value="1">
                <button type="submit" id="alarm-test-btn"
                  style="background-color: #555555; color: white; border: none; padding: 8px 16px; border-radius: var(--radius); cursor: pointer; font-weight: bold;">
                  Test Buzzer (2s)
                </button>
              </form>
            </div>
          </div>

          <div class="form-row">
            <div class="form-label">Reset Alarm Latch (<span id="ResetAlarmLatch_echo">0</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form" onsubmit="return handleResetLatch();">
                <input type="hidden" name="password" class="password_field">
                <input type="hidden" name="ResetAlarmLatch" value="1">
                <button type="submit" id="reset-latch-btn"
                  style="background-color: #555555; color: white; border: none; padding: 8px 16px; border-radius: var(--radius); cursor: pointer; font-weight: bold;">
                  Reset Latch
                </button>
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Alarm Status:</div>
            <div class="form-input">
              <div id="alarm-status-indicator" style="display: flex; align-items: center; gap: 10px;">
                <div id="alarm-led" style="
                   width: 20px;
                   height: 20px;
                   border-radius: 50%;
                   background-color: #00cc00;
                   border: 2px solid #333;
                   box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
                   transition: all 0.3s ease;
                 "></div>
                <span id="alarm-status-text" style="
                   font-weight: bold;
                   color: #00cc00;
                   transition: color 0.3s ease;
                 ">Silent</span>
              </div>
            </div>
          </div>



        </div>
      </div>

      <!-- Battery Monitor Settings Sub-tab -->
      <div id="settings-batterymonitor" class="sub-tab-content">
        <div class="settings-card">

          <div class="section-title">Battery Monitor</div>
          <hr />
          <div class="form-row">
            <div class="form-label">Battery Capacity (Amp hr) (<span id="BatteryCapacity_Ah_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="BatteryCapacity_Ah" type="number" step="1" min="1" max="10000" />
                <input onclick="submitMessage.call(this)" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Max Charge Detection Voltage (<span id="ChargedVoltage_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="ChargedVoltage" type="number" step="0.01" min="5" max="70" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Max Charge Detection Tail Current (%) (<span id="TailCurrent_echo">0</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">A percentage of battery capacity (A*hr), ex: 3% for 100A*hr bank = 3
                  amps
                </span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="TailCurrent" type="number" step="0.01" min="0.01" max="100" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Max Charge Detection Time (s) (<span id="ChargedDetectionTime_echo">?</span>):
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="ChargedDetectionTime" type="number" step="1" min="1" max="10000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label">Peukert Exponent (<span id="PeukertExponent_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="PeukertExponent" type="number" step="0.01" min="0.5" max="2.0" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Charge Efficiency (%) (<span id="ChargeEfficiency_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="ChargeEfficiency" type="number" step="1" min="30" max="150" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Shunt Resitance uOhms (micro)(<span id="ShuntResistanceMicroOhm_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Most common (Victron) = 100u</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="ShuntResistanceMicroOhm" type="number" step="1" min="1" max="5000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Set SoC (%) Manually (<span id="ManualSOCPoint_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="ManualSOCPoint" type="number" step="1" min="0" max="100" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">B Current Source (<span id="BatteryCurrentSource_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <select name="BatteryCurrentSource">
                  <option value="0">INA228 Shunt</option>
                  <option value="1">NMEA2K Battery</option>
                  <option value="2">NMEA0183 Battery</option>
                  <option value="3">Victron Battery</option>
                </select>
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

        </div>
      </div>

      <!-- System Settings Sub-tab -->
      <div id="settings-system" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">System</div>


          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>RPM Scaling Factor (<span id="RPMScalingFactor_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Used to convert measured stator frequency (Hz) into RPM. Adjust until RPM in
                  this App matches your tachometer. Decent guess = 1100.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="RPMScalingFactor" type="number" step="1" min="1" max="1000000" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>



          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Pulley Ratio, Alt to Engine (<span id="PulleyRatio_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">*** Only used for Alternator Lifetime Calcs *** Alternator RPM = Engine RPM
                  ×
                  this ratio. Common: 2.0-3.0 </span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <input name="PulleyRatio" type="number" step="0.01" min="1.0" max="10.0" />
                <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Limp Home Mode (<span id="LimpHome_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Will ignore all sensors and set a field of 50%</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="LimpHome_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('LimpHome_checkbox', 'LimpHome', 'LimpHome')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="LimpHome" name="LimpHome" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Ignition Override (<span id="IgnitionOverride_echo">0</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Don't depend on this setting- troubleshooting only! This is a great way to
                  drain battery by leaving Wifi functions on, and accidentally energize field.</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="IgnitionOverride_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('IgnitionOverride_checkbox', 'IgnitionOverride', 'IgnitionOverride')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="IgnitionOverride" name="IgnitionOverride" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label">Dark Mode:</div>
            <div class="form-input">
              <span class="toggle-label">Off</span>
              <label class="switch">
                <input id="DarkMode_checkbox" type="checkbox"
                  onchange="document.body.classList.toggle('dark-mode'); localStorage.setItem('darkMode', this.checked ? '1' : '0'); updateUplotTheme(currentTempPlot); updateUplotTheme(voltagePlot); updateUplotTheme(rpmPlot); updateUplotTheme(temperaturePlot);" />
                <span class="slider round"></span>
              </label>
              <span class="toggle-label">On</span>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">VE.Direct Data (<span id="VeData_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="VeData_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('VeData_checkbox', 'VeData', 'VeData')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="VeData" name="VeData" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">NMEA 0183 Data (<span id="NMEA0183Data_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="NMEA0183Data_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('NMEA0183Data_checkbox', 'NMEA0183Data', 'NMEA0183Data')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="NMEA0183Data" name="NMEA0183Data" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">NMEA2K Data (<span id="NMEA2KData_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="NMEA2KData_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('NMEA2KData_checkbox', 'NMEA2KData', 'NMEA2KData')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="NMEA2KData" name="NMEA2KData" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Defer to BMS Control (<span id="bmsLogic_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">No</span>
                <label class="switch">
                  <input id="bmsLogic_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('bmsLogic_checkbox', 'bmsLogic', 'bmsLogic')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">Yes</span>
                <input id="bmsLogic" name="bmsLogic" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label">Charge on ___ BMS Signal (<span id="bmsLogicLevelOff_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Low</span>
                <label class="switch">
                  <input id="bmsLogicLevelOff_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('bmsLogicLevelOff_checkbox', 'bmsLogicLevelOff', 'bmsLogicLevelOff')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">High</span>
                <input id="bmsLogicLevelOff" name="bmsLogicLevelOff" type="number" value="" style="display:none;" />
              </form>
            </div>
          </div>



          <hr />
          <div class="form-row">
            <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
              <span>Switch Panel Override (<span id="SwitchControlOverride_echo">?</span>):</span>
              <span class="tooltip" onclick="this.classList.toggle('active')">
                ℹ️
                <span class="tooltip-box">Obsolete, ignore</span>
              </span>
            </div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="SwitchControlOverride_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('SwitchControlOverride_checkbox', 'SwitchControlOverride', 'SwitchControlOverride')) { this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="SwitchControlOverride" name="SwitchControlOverride" type="number" value=""
                  style="display:none;" />
              </form>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label">Change Password:</div>
            <div class="form-input">
              <form action="/setPassword" method="POST" target="hidden-form" onsubmit="return setNewPassword();">
                <input type="hidden" name="password" class="password_field" />
                <div class="password-form">
                  <div class="password-input-group">
                    <input type="password" id="newpassword" name="newpassword" placeholder="New password"
                      class="password-input" />
                    <input type="submit" id="newpassword_set" value="Change" class="btn-primary" />
                    <div class="show-checkbox-container">
                      <input type="checkbox" class="show-checkbox" onclick="togglePassword('newpassword')">
                      <label class="show-label">Show</label>
                    </div>
                  </div>
                </div>
                <div id="newpassword_msg" style="font-size: 12px; color: #00a19a; margin-top: 5px;"></div>
              </form>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Lock Settings:</div>
            <div class="form-input">
              <button type="button" onclick="lockSettingsManually()" class="btn-primary">
                Lock Settings
              </button>
            </div>
          </div>

          <hr />
          <div class="form-row">
            <div class="form-label">Erase All Memory:</div>
            <div class="form-input">
              <button type="button" id="factory-reset-btn" onclick="factoryReset()" class="btn-primary">
                Restore Defaults
              </button>
            </div>
          </div>


          <hr />
          <div class="form-row">
            <div class="form-label">EXTRA (<span id="EXTRA_echo">?</span>):</div>
            <div class="form-input">
              <form action="/get" method="GET" target="hidden-form">
                <input type="hidden" name="password" class="password_field">
                <span class="toggle-label">Off</span>
                <label class="switch">
                  <input id="EXTRA_checkbox" type="checkbox"
                    onchange="if(handleUserToggle('EXTRA_checkbox','EXTRA','EXTRA')){ this.form.submit(); submitMessage(); }" />
                  <span class="slider round"></span>
                </label>
                <span class="toggle-label">On</span>
                <input id="EXTRA" name="EXTRA" type="number" value="0" style="display:none;" />
              </form>
            </div>
          </div>


        </div>
      </div>

      <!-- Software Update Sub-tab -->
      <div id="settings-softwareupdate" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">Software Update</div>

          <hr />

          <!-- Current Version Info -->

          <div class="form-row">
            <div class="form-label">Current Version:</div>
            <div class="form-value"><span id="current-version-display">Loading...</span></div>
          </div>

          <hr />

          <div class="form-row">
            <div class="form-input">
              <button class="btn-primary" onclick="loadAvailableVersions()">
                Refresh Available Versions
              </button>
            </div>
          </div>

          <!-- Available Versions -->
          <div class="form-row">
            <div class="form-label">Available Versions:</div>
            <div class="form-input">
              <div id="version-loading" style="text-align: center; padding: 20px;">
                Press refresh button...
              </div>
              <div id="version-list" style="display: none;">
                <!-- Versions will be populated here by JavaScript -->
              </div>
            </div>
          </div>

          <hr />

          <!-- Update Status -->
          <div id="update-status" style="display: none;">
            <div class="form-row">
              <div class="form-label">Update Status:</div>
              <div class="form-value">
                <div id="update-progress"></div>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>


  <div id="livedata" class="tab-content">
    <!-- Live Data Sub-tabs -->
    <div class="sub-tabs">
      <button class="sub-tab active" onclick="showSubTab('livedata', 'alternator')">Alternator</button>
      <button class="sub-tab" onclick="showSubTab('livedata', 'battery')">Battery</button>
      <button class="sub-tab" onclick="showSubTab('livedata', 'engine')">Engine</button>
      <button class="sub-tab" onclick="showSubTab('livedata', 'esp32')">ESP32</button>
      <button class="sub-tab" onclick="showSubTab('livedata', 'other')">Other</button>
    </div>
    <div class="settings-grid">


      <!-- Alternator Live Data Sub-tab -->
      <div id="livedata-alternator" class="sub-tab-content active">
        <div class="settings-card">
          <div class="section-title">Alternator</div>
          <div class="grid">
            <div class="card">
              <p>Alternator Current</p>
              <p class="reading"><span id="MeasAmpsID">0</span> A</p>
            </div>
            <div class="card">
              <p>Alternator Temp</p>
              <p class="reading"><span id="AltTempID">0</span> °F</p>
            </div>
            <div class="card">
              <p>Command Field Duty Cycle</p>
              <p class="reading"><span id="dutyCycleID">0</span> %</p>
            </div>
            <div class="card">
              <p>Field Volts (Calc'd)</p>
              <p class="reading"><span id="FieldVoltsID">0</span> V</p>
            </div>
            <div class="card">
              <p>Field Amps (Calc'd)) </p>
              <p class="reading"><span id="FieldAmpsID">0</span> A</p>
            </div>
            <div class="card">
              <p>Alternator On Time</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="AlternatorOnTimeID">0</span><span>H:M:S</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetAlternatorOnTime" id="ResetAlternatorOnTime" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetAlternatorOnTime')"
                    id="ResetAlternatorOnTime_button">Reset</button>
                </form>
              </div>
            </div>

            <div class="card">
              <p>Fuel Used by Alt</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="AlternatorFuelUsedID">0</span><span>L</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetFuelUsed" id="ResetFuelUsed" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetFuelUsed')"
                    id="ResetFuelUsed_button">Reset</button>
                </form>
              </div>
            </div>

            <div class="card">
              <p>Battery Charged Energy</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="ChargedEnergyID">0</span><span>Wh</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetEnergy" id="ResetEnergy" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetEnergy')"
                    id="ResetEnergy_button">Reset</button>
                </form>
              </div>
            </div>

            <div class="card">
              <p>Max Alternator Output Current</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="MeasuredAmpsMaxID">0</span><span>A</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetCurrent" id="ResetCurrent" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetCurrent')"
                    id="ResetCurrent_button">Reset</button>
                </form>
              </div>
            </div>

            <div class="card">
              <p>Alt Current Zero Offset (Auto-Learned)</p>
              <p class="reading"><span id="DynamicAltCurrentZero_display">0.000</span> A</p>
            </div>

            <div class="card">
              <p>Max Alternator Temp</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="MaxAlternatorTemperatureF_ID">0</span><span>°F</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetTemp" id="ResetTemp" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetTemp')"
                    id="ResetTemp_button">Reset</button>
                </form>
              </div>
            </div>

            <div class="card">
              <p>Insulation Life Remaining</p>
              <p class="reading" id="insulation-life-display">
                <span id="InsulationLifePercentID">100.0</span>%
                <span id="insulation-indicator"
                  style="margin-left: 8px; font-size: 12px; font-weight: bold;">Good</span>
              </p>
            </div>

            <div class="card">
              <p>Bearing Grease Life Remaining</p>
              <p class="reading" id="grease-life-display">
                <span id="GreaseLifePercentID">100.0</span>%
                <span id="grease-indicator" style="margin-left: 8px; font-size: 12px; font-weight: bold;">Good</span>
              </p>
            </div>

            <div class="card">
              <p>Brush Life Remaining</p>
              <p class="reading" id="brush-life-display">
                <span id="BrushLifePercentID">100.0</span>%
                <span id="brush-indicator" style="margin-left: 8px; font-size: 12px; font-weight: bold;">Good</span>
              </p>
            </div>

            <div class="card">
              <p>Predicted Life Remaining</p>
              <p class="reading" id="predicted-life-display">
                <span id="PredictedLifeHoursID">10000</span> hours
                <span id="predicted-indicator" style="margin-left: 8px; font-size: 12px; font-weight: bold;">Good</span>
              </p>
            </div>

            <div class="card">
              <p>Thermistor Temperature</p>
              <p class="reading"><span id="temperatureThermistorID">0</span> °C</p>
            </div>

            <div class="card">
              <p>Max Thermistor Temp</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="MaxTemperatureThermistorID">0</span><span>°C</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetThermTemp" id="ResetThermTemp" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetThermTemp')"
                    id="ResetThermTemp_button">Reset</button>
                </form>
              </div>
            </div>

          </div>
        </div>
      </div>


      <!-- Battery Live Data Sub-tab -->
      <div id="livedata-battery" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">Battery</div>
          <div class="grid">

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Battery Voltage (INA)</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Measured by INA228 uC - primary source</span>
                </span>
              </p>
              <p class="reading"><span id="IBVID">0</span> V</p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Battery Voltage (ADS)</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Measured by ADS1115 uC - for redundancy</span>
                </span>
              </p>
              <p class="reading"><span id="BatteryVID">0</span> V</p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Victron Battery Voltage</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Available if VE.Direct Data is turned on in Settings->System </span>
                </span>
              </p>
              <p class="reading"><span id="VictronVoltageID">0</span> V</p>
            </div>



            <div class="card">
              <p title="The highest battery voltage recorded since last reset.">Max Ever Battery Voltage</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="IBVMaxID">?</span><span>V</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetVoltage" id="ResetVoltage" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetVoltage')"
                    id="ResetVoltage_button">Reset</button>
                </form>
              </div>
            </div>



            <div class="card">
              <p>State of Charge</p>
              <p class="reading"><span id="SOC_percentID">0</span> %</p>
            </div>

            <div class="card">
              <p>Alternator Output Energy</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="AlternatorChargedEnergyID">0</span><span>Wh</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetAlternatorChargedEnergy" id="ResetAlternatorChargedEnergy"
                    value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetAlternatorChargedEnergy')"
                    id="ResetAlternatorChargedEnergy_button">Reset</button>
                </form>
              </div>
            </div>

            <div class="card">
              <p>Battery Discharged Energy</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="DischargedEnergyID">0</span><span>Wh</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetDischargedEnergy" id="ResetDischargedEnergy" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetDischargedEnergy')"
                    id="ResetDischargedEnergy_button">Reset</button>
                </form>
              </div>
            </div>

            <div class="card">
              <p>Battery Current</p>
              <p class="reading"><span id="BCurrID">0</span> A</p>
            </div>

            <div class="card">
              <p>Victron Battery Current</p>
              <p class="reading"><span id="VictronCurrentID">0</span> A</p>
            </div>

            <div class="card">
              <p>Time to Full Charge</p>
              <p class="reading"><span id="timeToFullChargeMinID">0</span> min</p>
            </div>

            <div class="card">
              <p>Time to Full Discharge</p>
              <p class="reading"><span id="timeToFullDischargeMinID">0</span> min</p>
            </div>

            <div class="card">
              <p>SOC Gain Factor (Auto-Learned)</p>
              <p class="reading"><span id="DynamicShuntGainFactor_display">1.000</span></p>
            </div>

          </div>
        </div>
      </div>


      <!-- Engine Live Data Sub-tab -->
      <div id="livedata-engine" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">Engine</div>
          <div class="grid">
            <div class="card">
              <p>Engine Speed</p>
              <p class="reading"><span id="RPMID">0</span> rev/min</p>
            </div>
            <div class="card">
              <p>Engine Run Time</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="EngineRunTimeID">0</span><span>H:M:S</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetEngineRunTime" id="ResetEngineRunTime" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetEngineRunTime')"
                    id="ResetEngineRunTime_button">Reset</button>
                </form>
              </div>
            </div>

            <div class="card">
              <p>Engine Rev Counter</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="EngineCyclesID">0</span><span>rotations</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetEngineCycles" id="ResetEngineCycles" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetEngineCycles')"
                    id="ResetEngineCycles_button">Reset</button>
                </form>
              </div>
            </div>

            <div class="card">
              <p>Max Engine RPM</p>
              <div class="reading" style="display: flex; align-items: center; gap: 4px;">
                <span id="RPMMaxID">0</span><span>rev/min</span>
                <form action="/get" method="GET" target="hidden-form" style="display: inline;">
                  <input type="hidden" name="ResetRPMMax" id="ResetRPMMax" value="0" />
                  <input type="hidden" name="password" class="password_field" />
                  <button type="button" class="btn-secondary" onclick="resetParameter('ResetRPMMax')"
                    id="ResetRPMMax_button">Reset</button>
                </form>
              </div>
            </div>
          </div>
        </div> <!-- ADD THIS: Closes Engine settings-card -->
      </div>

      <!-- ESP32 Live Data Sub-tab -->
      <div id="livedata-esp32" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">ESP32</div>
          <div class="grid">
            <!-- Current Session Performance -->

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>WiFi Mode</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">CLIENT = regultor is on ship's network, AP = regulator is providing its own hotspot</span>
                </span>
              </p>
              <p class="reading"><span id="currentModeID">?</span></p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Active Software Image</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Factory Golden = safe working default, User Updateable = some newer verions
                    loaded from Settings-> Software Updates</span>
                </span>
              </p>
              <p class="reading"><span id="currentPartitionTypeID">?</span></p>
            </div>
            
            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Device ID</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Unique identifier derived from ESP32 eFuse MAC address. Upper 32 bits: chipid >> 32, Lower 32 bits: chipid & 0xFFFFFFFF</span>
                </span>
              </p>
              <p class="reading"><span id="device-id-display">Loading...</span></p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Maximum Loop Time</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Maximum over last 5 seconds, updated every 1 second</span>
                </span>
              </p>
              <p class="reading"><span id="MaximumLoopTimeID">0</span> μs</p>
            </div>



            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Loop Time</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">The very last reading</span>
                </span>
              </p>
              <p class="reading"><span id="LoopTimeID">0</span> μs</p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Free Heap Memory</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Instantaneous reading. Includes 8MB PSRAM + internal SRAM</span>
                </span>
              </p>
              <p class="reading"><span id="FreeHeapID">0</span> kB</p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Min Free Heap</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">This session minimum. With PSRAM: 8MB+ typical. Critical below 1MB,
                    warning
                    below 4MB, no expected issues here</span>
                </span>
              </p>
              <p class="reading"><span id="MinFreeHeapID">0</span> kB</p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>WiFi Strength</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Above -67dBm good. Below -75dBm unstable</span>
                </span>
              </p>
              <p class="reading"><span id="WifiStrengthID">0</span> dBm</p>
            </div>

            <div class="card">
              <p>Current Session Duration</p>
              <p class="reading"><span id="CurrentSessionDurationID">0</span> min</p>
            </div>



            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Total Power Cycles</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">lifetime, or since re-flashing</span>
                </span>
              </p>
              <p class="reading"><span id="totalPowerCyclesID">0</span> </p>
            </div>




            <!-- Last Session Statistics -->
            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Last Session Max Loop Time</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Peak loop time from previous power cycle</span>
                </span>
              </p>
              <p class="reading"><span id="LastSessionMaxLoopTimeID">0</span> μs</p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Last Session Min Heap</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Lowest heap memory from previous power cycle. With PSRAM: expect 8MB+ aka
                    non-issue</span>
                </span>
              </p>
              <p class="reading"><span id="lastSessionMinHeapID">0</span> kB</p>
            </div>

            <div class="card">
              <p>Last Session Duration</p>
              <p class="reading"><span id="LastSessionDurationID">0</span> min</p>
            </div>


            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>WiFi Connects </span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">This power cycle, and after drops of >20 seconds</span>
                </span>
              </p>
              <p class="reading"><span id="wifiReconnectsTotalID">0</span> </p>
            </div>



            <div class="card">
              <p>Last Reset Reason</p>
              <p class="reading"><span id="LastResetReasonID">Unknown</span></p>
            </div>

            <div class="card">
              <p>Older Reset Reason</p>
              <p class="reading"><span id="ancientResetReasonID">Unknown</span></p>
            </div>

            <!-- Performance Timing -->
            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Analog Read Time (Max)</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">less than 3,000μs typical</span>
                </span>
              </p>
              <p class="reading"><span id="AnalogReadTimeID">0</span> μs</p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>Wifi Send Time</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box" <1,000μs typical; this measures the frequent payload (data for plots/wifi
                    stats)</span>
                  </span>
              </p>
              <p class="reading"><span id="SendWifiTimeID">0</span> μs</p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>VE Direct Read Time</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">12,000μs typical for Victron data</span>
                </span>
              </p>
              <p class="reading"><span id="VeTimeID">0</span> μs</p>
            </div>

            <div class="card">
              <p style="display: flex; align-items: center; justify-content: space-between;">
                <span>WiFi Heartbeat</span>
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">Increments with each packet sent</span>
                </span>
              </p>
              <p class="reading"><span id="WifiHeartBeatID">0</span></p>
            </div>

          </div>
        </div>
      </div>

      <!-- Other Live Data Sub-tab -->
      <div id="livedata-other" class="sub-tab-content">
        <div class="settings-card">
          <div class="section-title">Other</div>
          <div class="grid">

            <div class="card">
              <p>Barometric Pressure</p>
              <p class="reading" id="baroPressure-display">
                <span id="baroPressureID">0</span> mbar
              </p>
            </div>

            <div class="card">
              <p>Board Temperature
                <span class="tooltip" onclick="this.classList.toggle('active')">
                  ℹ️
                  <span class="tooltip-box">
                    Temperature measured in the regulator (°C), could be a bit hotter than
                    ambient depending on location and electrical demands
                  </span>
                </span>
              </p>
              <p class="reading" id="ambientTemp-display">
                <span id="ambientTempID">0</span> °C
              </p>
            </div>


            <div class="card">
              <p>GPS Heading</p>
              <p class="reading"><span id="HeadingNMEAID">0</span> °</p>
            </div>

            <div class="card">
              <p>ADS Ch3 Voltage</p>
              <p class="reading"><span id="ADS3ID">0</span> V</p>
            </div>
            <div class="card">
              <p>GPS Latitude</p>
              <p class="reading"><span id="LatitudeNMEA_ID">0</span>°</p>
            </div>
            <div class="card">
              <p>GPS Longitude</p>
              <p class="reading"><span id="LongitudeNMEA_ID">0</span>°</p>
            </div>
            <div class="card">
              <p># Satellites</p>
              <p class="reading"><span id="SatelliteCountNMEA_ID">0</span></p>
            </div>


          </div> <!-- Closes .grid -->
        </div> <!-- Closes settings-card (Other) -->
      </div> <!-- CLOSE settings-grid for Live Data -->

    </div>
  </div>

  <!-- PLOTS SECTION WITH SUBTABS -->
  <div id="plots" class="tab-content">
    <!-- Plots Sub-tabs -->
    <div class="sub-tabs">
      <button class="sub-tab active" onclick="showSubTab('plots', 'displays')">Plots</button>
      <button class="sub-tab" onclick="showSubTab('plots', 'controls')">Plot Controls</button>
    </div>

    <!-- Plot Displays Sub-tab - This should be active by default -->
    <div id="plots-displays" class="sub-tab-content active">
      <div class="settings-card">
        <div class="plot-container" id="voltage-plot"></div>
      </div>
      <div class="settings-card">
        <div class="plot-container" id="temperature-plot"></div>
      </div>
      <div class="settings-card">
        <div class="plot-container" id="current-temp-plot"></div>
      </div>
      <div class="settings-card">
        <div class="plot-container" id="rpm-plot"></div>
      </div>
    </div>

    <!-- Plot Controls Sub-tab - Remove the active class from here -->
    <div id="plots-controls" class="sub-tab-content">
      <div class="settings-card">
        <div class="section-title">Plot Controls</div>

        <!--         <hr />
        <div class="form-row">
          <div class="form-label">Plot Points (X axis length) (<span id="maxPoints_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="maxPoints" type="number" step="1" min="2" max="10000" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div> -->

        <hr />
        <div class="form-row">
          <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
            <span>Update Rate (ms) (<span id="webgaugesinterval_echo">?</span>):</span>
            <span class="tooltip" onclick="this.classList.toggle('active')">
              ℹ️
              <span class="tooltip-box">How often sensor data is sent to this display (milliseconds). Lower = more
                responsive display but higher CPU/network load. Range: 50-1000ms. Does not affect actual control
                speed.</span>
            </span>
          </div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="webgaugesinterval" type="number" step="1" min="50" max="5000" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>


        <hr />
        <div class="form-row">
          <div class="form-label">Plot Time Window (sec) (<span id="plotTimeWindow_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="plotTimeWindow" type="number" step="0.001" min=".001" max="600" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>

        <hr />
        <div class="form-row">
          <div class="form-label" style="display: flex; align-items: center; justify-content: space-between;">
            <span>Time Axis Labels (<span id="timeAxisModeChanging_echo">?</span>):</span>
            <span class="tooltip" onclick="this.classList.toggle('active')">
              ℹ️
              <span class="tooltip-box">
                UNIX: Proper time labels, but slower<br>
                Relative: "Seconds ago" labels, but smoother plotting
              </span>
            </span>
          </div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <span class="toggle-label">Relative</span>
              <label class="switch">
                <input id="timeAxisModeChanging_checkbox" type="checkbox"
                  onchange="if(handleUserToggle('timeAxisModeChanging_checkbox', 'timeAxisModeChanging', 'timeAxisModeChanging')) { this.form.submit(); submitMessage(); }" />
                <span class="slider round"></span>
              </label>
              <span class="toggle-label">UNIX</span>
              <input id="timeAxisModeChanging" name="timeAxisModeChanging" type="number" value=""
                style="display:none;" />
            </form>
          </div>
        </div>

        <!-- Y-Axis Range Controls Section -->
        <hr />
        <div class="section-title" style="margin-top: 20px;">Y-Axis Ranges</div>

        <hr />
        <div class="form-row">
          <div class="form-label">Y Axis Min (Current) (<span id="Ymin1_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="Ymin1" type="number" step="1" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>

        <hr />
        <div class="form-row">
          <div class="form-label">Y Axis Max (Current) (<span id="Ymax1_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="Ymax1" type="number" step="1" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>

        <hr />
        <div class="form-row">
          <div class="form-label">Y Axis Min (Voltage) (<span id="Ymin2_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="Ymin2" type="number" step="1" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>

        <hr />
        <div class="form-row">
          <div class="form-label">Y Axis Max (Voltage) (<span id="Ymax2_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="Ymax2" type="number" step="1" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>

        <hr />
        <div class="form-row">
          <div class="form-label">Y Axis Min (RPM) (<span id="Ymin3_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="Ymin3" type="number" step="1" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>

        <hr />
        <div class="form-row">
          <div class="form-label">Y Axis Max (RPM) (<span id="Ymax3_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="Ymax3" type="number" step="1" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>

        <hr />
        <div class="form-row">
          <div class="form-label">Y Axis Min (Temperature) (<span id="Ymin4_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="Ymin4" type="number" step="1" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>

        <hr />
        <div class="form-row">
          <div class="form-label">Y Axis Max (Temperature) (<span id="Ymax4_echo">?</span>):</div>
          <div class="form-input">
            <form action="/get" method="GET" target="hidden-form">
              <input type="hidden" name="password" class="password_field">
              <input name="Ymax4" type="number" step="1" />
              <input onclick="submitMessage()" type="submit" value="Set" class="btn-primary" />
            </form>
          </div>
        </div>

      </div>
    </div>
  </div>


  <!-- Console -->
  <div id="console" class="tab-content">
    <div class="settings-card wide-card">
      <div class="form-label">
        Console
        <button onclick="clearConsole()" style="font-size: 12px; margin-left: 10px;">Clear</button>
      </div>
      <div id="consoleOutput" class="responsive-console"></div>
    </div>
  </div>


  <!-- 2. ADD THIS ENTIRE SECTION AFTER THE CONSOLE TAB (around line 1550) -->
  <!-- About Tab -->
  <div id="about" class="tab-content">
    <!-- About Sub-tabs -->
    <div class="sub-tabs">
      <button class="sub-tab active" onclick="showSubTab('about', 'version')">Version</button>
      <button class="sub-tab" onclick="showSubTab('about', 'userguide')">User Guide/FAQ</button>
      <button class="sub-tab" onclick="showSubTab('about', 'sourcecode')">Source Code</button>
    </div>

    <!-- Version Sub-tab -->
    <div id="about-version" class="sub-tab-content active">
      <div class="settings-card">
        <div class="section-title">X Engineering Alternator Regulator</div>
        <div style="text-align: center; margin: 20px 0;">
          <h2 style="color: var(--accent); margin: 10px 0;">Version 4.1</h2>
        </div>

        <hr />
        <div class="section-title">About X Engineering</div>
        <p style="line-height: 1.6; color: var(--text-dark); margin: 15px 0;">
          This is an experimental business offering unique and open-source marine electronics.
          Costs are kept very low thanks to heavy use of AI, internet forums, and
          freelance engineers from around the world.
        </p>

        <hr />
        <div class="section-title">Development Team</div>

        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 10px 0;">Alternator Controller</h4>
          <ul style="margin: 5px 0; padding-left: 20px; color: var(--text-dark);">
            <li>Joe CEO</li>
            <li>Avinadad Alonso</li>
            <li>Mark Nickerson</li>
            <li>Shoaib Ali</li>
            <li>Chathuni Wijegunawardana</li>
          </ul>
        </div>

        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 10px 0;">Library Development</h4>
          <ul style="margin: 5px 0; padding-left: 20px; color: var(--text-dark);">
            <li>Rob Tillaart</li>
          </ul>
        </div>

        <hr />
        <div
          style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--accent); margin: 15px 0;">
          <p style="margin: 0; font-size: 12px; color: var(--text-dark);">
            Built with ESP32 • Open Source Hardware & Software •
            <span style="color: var(--accent);">Made for Marine Applications</span>
          </p>
        </div>
      </div>
    </div>

    <!-- User Guide/FAQ Sub-tab -->
    <div id="about-userguide" class="sub-tab-content">
      <div class="settings-card">
        <div class="section-title">User Guide & FAQ</div>

        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">Quick Start Guide</h4>
          <ol style="line-height: 1.6; color: var(--text-dark); padding-left: 20px;">
            <li><strong>Initial Setup:</strong> Connect to device WiFi network "Alt_Regulator_XXXX"</li>
            <li><strong>Access Interface:</strong> Navigate to 192.168.4.1 in your browser</li>
            <li><strong>Unlock Settings:</strong> Enter admin password to modify configuration</li>
            <li><strong>Configure Alternator:</strong> Set target amps, temperature limits, and voltage thresholds
            </li>
            <li><strong>Enable Learning:</strong> Turn on PID Temperature Optimizer for automatic optimization</li>
          </ol>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">Frequently Asked Questions</h4>

          <div style="margin: 15px 0;">
            <h5 style="color: var(--text-dark); margin: 5px 0;">Q: What does the Learning Mode do?</h5>
            <p style="margin: 5px 0; padding-left: 15px; color: var(--text-dark); font-size: 14px;">
              Learning Mode automatically optimizes alternator output based on temperature feedback.
              It learns safe current limits for different RPM ranges to maximize charging while preventing
              overheating.
            </p>
          </div>

          <div style="margin: 15px 0;">
            <h5 style="color: var(--text-dark); margin: 5px 0;">Q: How do I reset if I forget the password?</h5>
            <p style="margin: 5px 0; padding-left: 15px; color: var(--text-dark); font-size: 14px;">
              You can still turn OFF the alternator for safety without a password. To reset settings,
              you'll need to perform a factory reset by pressing the physical reset button on the device.
            </p>
          </div>

          <div style="margin: 15px 0;">
            <h5 style="color: var(--text-dark); margin: 5px 0;">Q: What's the difference between Hi/Low targets?</h5>
            <p style="margin: 5px 0; padding-left: 15px; color: var(--text-dark); font-size: 14px;">
              Normal target is for regular charging. Low target reduces output for extended operation,
              longer alternator life, or when operating in high ambient temperatures.
            </p>
          </div>

          <div style="margin: 15px 0;">
            <h5 style="color: var(--text-dark); margin: 5px 0;">Q: How does Weather Mode work?</h5>
            <p style="margin: 5px 0; padding-left: 15px; color: var(--text-dark); font-size: 14px;">
              Weather Mode fetches solar forecasts and reduces alternator charging when good solar
              conditions are predicted, saving fuel and reducing wear on your alternator.
            </p>
          </div>
        </div>

        <hr />
        <div
          style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--accent); margin: 15px 0;">
          <p style="margin: 0; font-size: 12px; color: var(--text-dark);">
            <strong>Need Help?</strong> Visit our support forum at forums.xengineering.com or
            contact support@xengineering.com for technical assistance.
          </p>
        </div>
      </div>
    </div>

    <!-- Source Code Sub-tab -->
    <div id="about-sourcecode" class="sub-tab-content">
      <div class="settings-card">
        <div class="section-title">Source Code & Development</div>

        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">Open Source License</h4>
          <p style="line-height: 1.6; color: var(--text-dark); margin: 10px 0;">
            This project is released under the MIT License, allowing free use, modification,
            and distribution. We encourage community contributions and improvements.
          </p>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">Repository Information</h4>
          <div
            style="font-family: monospace; background: var(--card-light); padding: 10px; border-radius: var(--radius); margin: 10px 0;">
            <p style="margin: 5px 0; color: var(--text-dark);"><strong>Main Repository:</strong>
              github.com/xengineering/alternator-regulator</p>
            <p style="margin: 5px 0; color: var(--text-dark);"><strong>Hardware Files:</strong>
              github.com/xengineering/alternator-regulator-hw</p>
            <p style="margin: 5px 0; color: var(--text-dark);"><strong>Documentation:</strong>
              docs.xengineering.com/alternator</p>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">Key Technologies</h4>
          <ul style="line-height: 1.6; color: var(--text-dark); padding-left: 20px;">
            <li><strong>Microcontroller:</strong> ESP32-S3 with WiFi capabilities</li>
            <li><strong>Web Interface:</strong> HTML5, CSS3, JavaScript with uPlot charting</li>
            <li><strong>Real-time Data:</strong> Server-Sent Events (SSE) for live updates</li>
            <li><strong>Control Algorithm:</strong> PID controller with machine learning optimization</li>
            <li><strong>Sensors:</strong> INA228 current/voltage, DS18B20 temperature, hall effect RPM</li>
            <li><strong>Communication:</strong> NMEA 0183/2000, VE.Direct protocols</li>
          </ul>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">Build Information</h4>
          <div
            style="font-family: monospace; background: var(--card-light); padding: 10px; border-radius: var(--radius); margin: 10px 0;">
            <p style="margin: 5px 0; color: var(--text-dark);"><strong>Firmware Version:</strong> 4.1.0-stable</p>
            <p style="margin: 5px 0; color: var(--text-dark);"><strong>Build Date:</strong> <span
                id="build-date">2024-12-20 15:30:42 UTC</span></p>
            <p style="margin: 5px 0; color: var(--text-dark);"><strong>Compiler:</strong> ESP-IDF v5.1.2</p>
            <p style="margin: 5px 0; color: var(--text-dark);"><strong>Web UI:</strong> Responsive HTML5 with
              real-time
              plotting</p>
          </div>
        </div>

        <hr />
        <div
          style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--accent); margin: 15px 0;">
          <p style="margin: 0; font-size: 12px; color: var(--text-dark);">
            <strong>Contributing:</strong> We welcome bug reports, feature requests, and code contributions.
            Please see our contribution guidelines in the GitHub repository.
          </p>
        </div>
      </div>
    </div>
  </div>


  <!-- 2. ADD THIS ENTIRE SECTION AFTER THE ABOUT TAB -->
  <!-- Community Tab -->
  <div id="community" class="tab-content">
    <!-- Community Sub-tabs -->
    <div class="sub-tabs">
      <button class="sub-tab active" onclick="showSubTab('community', 'leaderboards')">Leaderboards</button>
      <button class="sub-tab" onclick="showSubTab('community', 'history')">My History</button>
      <button class="sub-tab" onclick="showSubTab('community', 'profile')">My Profile</button>
    </div>

    <!-- Leaderboards Sub-tab -->
    <div id="community-leaderboards" class="sub-tab-content active">
      <div class="settings-card">
        <div class="section-title">Global Leaderboards</div>
        <p style="text-align: center; color: var(--text-dark); margin: 10px 0; font-size: 14px;">
          Anonymous performance data from X Engineering users worldwide
        </p>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">🏆 Most Efficient Charging (Last 30 Days)</h4>
          <div style="background: var(--card-light); border-radius: var(--radius); overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead style="background: var(--accent); color: white;">
                <tr>
                  <th style="padding: 10px; text-align: left;">Rank</th>
                  <th style="padding: 10px; text-align: left;">Vessel</th>
                  <th style="padding: 10px; text-align: right;">Efficiency</th>
                  <th style="padding: 10px; text-align: right;">kWh Charged</th>
                </tr>
              </thead>
              <tbody>
                <tr style="border-bottom: 1px solid var(--border);">
                  <td style="padding: 8px; color: var(--text-dark);">1st 🥇</td>
                  <td style="padding: 8px; color: var(--text-dark);">SeaWind_47</td>
                  <td style="padding: 8px; text-align: right; color: var(--accent); font-weight: bold;">94.2%</td>
                  <td style="padding: 8px; text-align: right; color: var(--text-dark);">847.3</td>
                </tr>
                <tr style="border-bottom: 1px solid var(--border);">
                  <td style="padding: 8px; color: var(--text-dark);">2nd 🥈</td>
                  <td style="padding: 8px; color: var(--text-dark);">BlueWater_Cat</td>
                  <td style="padding: 8px; text-align: right; color: var(--accent); font-weight: bold;">92.8%</td>
                  <td style="padding: 8px; text-align: right; color: var(--text-dark);">1,203.7</td>
                </tr>
                <tr style="border-bottom: 1px solid var(--border);">
                  <td style="padding: 8px; color: var(--text-dark);">3rd 🥉</td>
                  <td style="padding: 8px; color: var(--text-dark);">Pacific_Wanderer</td>
                  <td style="padding: 8px; text-align: right; color: var(--accent); font-weight: bold;">91.5%</td>
                  <td style="padding: 8px; text-align: right; color: var(--text-dark);">692.1</td>
                </tr>
                <tr style="border-bottom: 1px solid var(--border); background: var(--card-light);">
                  <td style="padding: 8px; color: var(--accent); font-weight: bold;">12th</td>
                  <td style="padding: 8px; color: var(--accent); font-weight: bold;">⭐ Your Vessel</td>
                  <td style="padding: 8px; text-align: right; color: var(--accent); font-weight: bold;">87.3%</td>
                  <td style="padding: 8px; text-align: right; color: var(--accent); font-weight: bold;">456.8</td>
                </tr>
                <tr style="border-bottom: 1px solid var(--border);">
                  <td style="padding: 8px; color: var(--text-dark);">13th</td>
                  <td style="padding: 8px; color: var(--text-dark);">WindDancer_39</td>
                  <td style="padding: 8px; text-align: right; color: var(--text-dark);">86.9%</td>
                  <td style="padding: 8px; text-align: right; color: var(--text-dark);">328.4</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">⚡ Highest Power Output (Single Session)</h4>
          <div style="background: var(--card-light); border-radius: var(--radius); overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead style="background: var(--accent); color: white;">
                <tr>
                  <th style="padding: 10px; text-align: left;">Rank</th>
                  <th style="padding: 10px; text-align: left;">Vessel</th>
                  <th style="padding: 10px; text-align: right;">Peak Power</th>
                  <th style="padding: 10px; text-align: right;">Duration</th>
                </tr>
              </thead>
              <tbody>
                <tr style="border-bottom: 1px solid var(--border);">
                  <td style="padding: 8px; color: var(--text-dark);">1st 🥇</td>
                  <td style="padding: 8px; color: var(--text-dark);">PowerCat_65</td>
                  <td style="padding: 8px; text-align: right; color: var(--accent); font-weight: bold;">4.8 kW</td>
                  <td style="padding: 8px; text-align: right; color: var(--text-dark);">2.3 hrs</td>
                </tr>
                <tr style="border-bottom: 1px solid var(--border);">
                  <td style="padding: 8px; color: var(--text-dark);">2nd 🥈</td>
                  <td style="padding: 8px; color: var(--text-dark);">OceanRover_55</td>
                  <td style="padding: 8px; text-align: right; color: var(--accent); font-weight: bold;">4.2 kW</td>
                  <td style="padding: 8px; text-align: right; color: var(--text-dark);">1.8 hrs</td>
                </tr>
                <tr style="border-bottom: 1px solid var(--border);">
                  <td style="padding: 8px; color: var(--text-dark);">3rd 🥉</td>
                  <td style="padding: 8px; color: var(--text-dark);">DeepBlue_Mono</td>
                  <td style="padding: 8px; text-align: right; color: var(--accent); font-weight: bold;">3.9 kW</td>
                  <td style="padding: 8px; text-align: right; color: var(--text-dark);">4.1 hrs</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">🌍 Global Statistics</h4>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Active Users</p>
              <p class="reading" style="color: var(--accent); font-size: 24px; font-weight: bold;">1,247</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Total Energy (30d)</p>
              <p class="reading" style="color: var(--accent); font-size: 24px; font-weight: bold;">12.4 MWh</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Avg Efficiency</p>
              <p class="reading" style="color: var(--accent); font-size: 24px; font-weight: bold;">83.2%</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Learning Systems</p>
              <p class="reading" style="color: var(--accent); font-size: 24px; font-weight: bold;">892</p>
            </div>
          </div>
        </div>

        <hr />
        <div
          style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--accent); margin: 15px 0;">
          <p style="margin: 0; font-size: 12px; color: var(--text-dark);">
            <strong>Privacy:</strong> All data is anonymous and aggregated. No personal information or vessel
            identification is shared.
            Participation in community features can be disabled in Settings > System.
          </p>
        </div>
      </div>
    </div>

    <!-- My History Sub-tab -->
    <div id="community-history" class="sub-tab-content">
      <div class="settings-card">
        <div class="section-title">My Performance History</div>
        <p style="text-align: center; color: var(--text-dark); margin: 10px 0; font-size: 14px;">
          Your charging performance trends and historical data
        </p>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">📊 Recent Performance (Last 30 Days)</h4>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Energy Charged</p>
              <p class="reading" style="color: var(--accent); font-size: 20px; font-weight: bold;">456.8 kWh</p>
              <p style="font-size: 10px; color: var(--text-dark);">↑ 12% vs previous month</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Energy Discharged</p>
              <p class="reading" style="color: var(--accent); font-size: 20px; font-weight: bold;">398.7 kWh</p>
              <p style="font-size: 10px; color: var(--text-dark);">↑ 8% vs previous month</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Avg Efficiency</p>
              <p class="reading" style="color: var(--accent); font-size: 20px; font-weight: bold;">87.3%</p>
              <p style="font-size: 10px; color: var(--text-dark);">↑ 2.1% vs previous month</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Engine Hours</p>
              <p class="reading" style="color: var(--accent); font-size: 20px; font-weight: bold;">127.4 hrs</p>
              <p style="font-size: 10px; color: var(--text-dark);">↓ 5% vs previous month</p>
            </div>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">📈 Historical Trends (Last 12 Months)</h4>
          <div style="background: var(--card-light); padding: 15px; border-radius: var(--radius); margin: 10px 0;">
            <div
              style="text-align: center; color: var(--text-dark); padding: 40px 0; border: 2px dashed var(--border); border-radius: var(--radius);">
              <p style="margin: 0; font-size: 16px;">📊 Historical Chart Placeholder</p>
              <p style="margin: 5px 0; font-size: 12px; opacity: 0.7;">
                Energy charged/discharged trends, efficiency improvements, and learning progress
              </p>
            </div>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">🎯 Personal Achievements</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div
              style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid #4CAF50;">
              <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 24px;">🏃‍♂️</span>
                <div>
                  <h5 style="margin: 0; color: var(--text-dark);">Quick Learner</h5>
                  <p style="margin: 0; font-size: 12px; color: var(--text-dark);">Learning system optimized in under
                    50
                    hours</p>
                </div>
              </div>
            </div>
            <div
              style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid #FF9800;">
              <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 24px;">⚡</span>
                <div>
                  <h5 style="margin: 0; color: var(--text-dark);">Power User</h5>
                  <p style="margin: 0; font-size: 12px; color: var(--text-dark);">Charged over 1 MWh total energy</p>
                </div>
              </div>
            </div>
            <div
              style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid #2196F3;">
              <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 24px;">🌱</span>
                <div>
                  <h5 style="margin: 0; color: var(--text-dark);">Eco Warrior</h5>
                  <p style="margin: 0; font-size: 12px; color: var(--text-dark);">90%+ average efficiency for 6 months
                  </p>
                </div>
              </div>
            </div>
            <div
              style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid #9C27B0;">
              <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 24px;">🔧</span>
                <div>
                  <h5 style="margin: 0; color: var(--text-dark);">Early Adopter</h5>
                  <p style="margin: 0; font-size: 12px; color: var(--text-dark);">Beta testing X Engineering products
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <hr />
        <div
          style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--accent); margin: 15px 0;">
          <p style="margin: 0; font-size: 12px; color: var(--text-dark);">
            <strong>Data Retention:</strong> Historical data is stored locally and backed up to X Engineering servers
            (encrypted).
            You can export or delete your data at any time from Settings > System.
          </p>
        </div>
      </div>
    </div>

    <!-- My Profile Sub-tab -->
    <div id="community-profile" class="sub-tab-content">
      <div class="settings-card">
        <div class="section-title">My Vessel Profile</div>
        <p style="text-align: center; color: var(--text-dark); margin: 10px 0; font-size: 14px;">
          Vessel specifications and system configuration
        </p>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">🚤 Vessel Information</h4>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Vessel Name</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Sea Wanderer</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Vessel Type</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Sailing Catamaran
              </p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Length Overall</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">42 ft</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Year Built</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">2018</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Home Port</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">San Diego, CA</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Registration</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">CF-1234-AB</p>
            </div>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">⚙️ Engine & Alternator</h4>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Engine Make/Model</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Yanmar 4JH57</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Engine Power</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">57 HP</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Alternator Type</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Balmar AT-200</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Alternator Rating</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">200A @ 12V</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Pulley Ratio</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">2.5:1</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Installation Date</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Mar 2024</p>
            </div>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">🔋 Battery System</h4>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Battery Technology</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">LiFePO4</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Total Capacity</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">800 Ah</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Battery Voltage</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">12V</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Battery Monitor</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Victron BMV-712</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Solar Array</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">800W</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Wind Generator</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">400W Air-X</p>
            </div>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">🎛️ System Configuration</h4>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Controller Serial</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">XE-AR-2024-0847</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Firmware Version</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">4.1.0</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Learning Mode</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Enabled</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Weather Integration</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Active</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">NMEA Integration</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">2000 + 0183</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Total Operating Hours</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">1,247 hrs</p>
            </div>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <h4 style="color: var(--accent); margin: 15px 0;">👤 Owner Information</h4>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Captain</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">J. Smith</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Experience Level</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Advanced</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Primary Use</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Liveaboard Cruising
              </p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Typical Voyage</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Coastal / Offshore
              </p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Installation Tech</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">Certified Marine
                Electrician</p>
            </div>
            <div class="card">
              <p style="font-size: 12px; color: var(--text-dark); margin: 5px 0;">Community Member Since</p>
              <p style="color: var(--accent); font-size: 16px; font-weight: bold; margin: 5px 0;">March 2024</p>
            </div>
          </div>
        </div>

        <hr />
        <div style="margin: 20px 0;">
          <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <button
              style="background-color: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: var(--radius); cursor: pointer; font-weight: bold;">
              📝 Edit Profile
            </button>
            <button
              style="background-color: #555555; color: white; border: none; padding: 10px 20px; border-radius: var(--radius); cursor: pointer; font-weight: bold;">
              📊 Export Data
            </button>
            <button
              style="background-color: #555555; color: white; border: none; padding: 10px 20px; border-radius: var(--radius); cursor: pointer; font-weight: bold;">
              🔒 Privacy Settings
            </button>
          </div>
        </div>

        <hr />
        <div
          style="background: var(--card-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--accent); margin: 15px 0;">
          <p style="margin: 0; font-size: 12px; color: var(--text-dark);">
            <strong>Profile Visibility:</strong> Your profile information is used for system optimization and
            community
            features.
            Personal details are never shared publicly - only aggregated performance data contributes to leaderboards.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div id="corner-status" class="corner-status corner-status-connected">CONNECTED</div>

  <!-- span id's are for display values that JavaScript updates dynamically
 Read-only .  Basically sensor readings, calculated values, button and setting echos -->
  <div style="display:none;">
    <span id="RPMMaxID" style="display:none;">0</span>
    <span id="SOC_percentID" style="display:none;">0</span>
    <span id="EngineRunTimeID" style="display:none;">0</span>
    <span id="EngineCyclesID" style="display:none;">0</span>
    <span id="AlternatorOnTimeID" style="display:none;">0</span>
    <span id="AlternatorFuelUsedID" style="display:none;">0</span>
    <span id="ChargedEnergyID" style="display:none;">0</span>
    <span id="DischargedEnergyID" style="display:none;">0</span>
    <span id="AlternatorChargedEnergyID" style="display:none;">0</span>
    <span id="MaxAlternatorTemperatureF_ID" style="display:none;">0</span>
    <span id="TemperatureLimitF_echo" style="display:none;">0</span>
    <span id="BulkVoltage_echo" style="display:none;">0</span>
    <span id="TargetAmps_echo" style="display:none;">0</span>
    <span id="FloatVoltage_echo" style="display:none;">0</span>
    <span id="SwitchingFrequency_echo" style="display:none;">0</span>
    <span id="dutyStep_echo" style="display:none;">0</span>
    <span id="FieldAdjustmentInterval_echo" style="display:none;">0</span>
    <span id="ManualDutyTarget_echo" style="display:none;">0</span>
    <span id="SwitchControlOverride_echo" style="display:none;">0</span>
    <span id="OnOff_echo" style="display:none;">0</span>
    <span id="ManualFieldToggle_echo" style="display:none;">0</span>
    <span id="HiLow_echo" style="display:none;">0</span>
    <span id="LimpHome_echo" style="display:none;">0</span>
    <span id="VeData_echo" style="display:none;">0</span>
    <span id="NMEA0183Data_echo" style="display:none;">0</span>
    <span id="NMEA2KData_echo" style="display:none;">0</span>
    <span id="TargetAmpL_echo" style="display:none;">0</span>
    <span id="CurrentThreshold_echo" style="display:none;">0</span>
    <span id="PeukertExponent_echo" style="display:none;">0</span>
    <span id="ChargeEfficiency_echo" style="display:none;">0</span>
    <span id="ChargedVoltage_echo" style="display:none;">0</span>
    <span id="TailCurrent_echo" style="display:none;">0</span>
    <span id="ChargedDetectionTime_echo" style="display:none;">0</span>
    <span id="IgnoreTemperature_echo" style="display:none;">0</span>
    <span id="bmsLogic_echo" style="display:none;">0</span>
    <span id="bmsLogicLevelOff_echo" style="display:none;">0</span>
    <span id="AlarmActivate_echo" style="display:none;">0</span>
    <span id="TempAlarm_echo" style="display:none;">0</span>
    <span id="VoltageAlarmHigh_echo" style="display:none;">0</span>
    <span id="VoltageAlarmLow_echo" style="display:none;">0</span>
    <span id="CurrentAlarmHigh_echo" style="display:none;">0</span>
    <span id="FourWay_echo" style="display:none;">0</span>
    <span id="RPMScalingFactor_echo" style="display:none;">0</span>
    <span id="ResetTemp_echo" style="display:none;">0</span>
    <span id="ResetVoltage_echo" style="display:none;">0</span>
    <span id="ResetCurrent_echo" style="display:none;">0</span>
    <span id="ResetEngineRunTime_echo" style="display:none;">0</span>
    <span id="ResetAlternatorOnTime_echo" style="display:none;">0</span>
    <span id="ResetEnergy_echo" style="display:none;">0</span>
    <span id="ResetAlternatorChargedEnergy_echo" style="display:none;">0</span>
    <span id="ResetDischargedEnergy_echo" style="display:none;">0</span>
    <span id="ResetFuelUsed_echo" style="display:none;">0</span>
    <span id="ResetEngineCycles_echo" style="display:none;">0</span>
    <span id="ResetRPMMax_echo" style="display:none;">0</span>
    <span id="FuelUsedID" style="display:none;">0</span>
    <span id="MaximumAllowedBatteryAmps_echo" style="display:none;">0</span>
    <span id="ManualSOCPoint_echo" style="display:none;">0</span>
    <span id="BatteryVoltageSource_echo" style="display:none;">0</span>
    <span id="ShuntResistanceMicroOhm_echo" style="display:none;">0</span>
    <span id="InvertAltAmps_echo" style="display:none;">0</span>
    <span id="InvertBattAmps_echo" style="display:none;">0</span>
    <span id="MaxDuty_echo" style="display:none;">0</span>
    <span id="MinDuty_echo" style="display:none;">0</span>
    <span id="FieldResistance_echo" style="display:none;">0</span>
    <span id="maxPoints_echo" style="display:none;">0</span>
    <span id="BatteryCOffset_echo" style="display:none;">0</span>
    <span id="AlternatorCOffset_echo" style="display:none;">0</span>
    <span id="BatteryCapacity_Ah_echo" style="display:none;">0</span>
    <span id="AmpSrc_echo" style="display:none;">0</span>
    <span id="R_fixed_echo" style="display:none;">0</span>
    <span id="Beta_echo" style="display:none;">0</span>
    <span id="T0_C_echo" style="display:none;">0</span>
    <span id="TempSource_echo" style="display:none;">0</span>
    <span id="IgnitionOverride_echo" style="display:none;">0</span>
    <span id="AlarmLatchEnabled_echo" style="display:none;">0</span>
    <span id="AlarmTest_echo" style="display:none;">0</span>
    <span id="ResetAlarmLatch_echo" style="display:none;">0</span>
    <span id="AlarmLatchState_display" style="display:none;">Normal</span>
    <span id="ForceFloat_echo" style="display:none;">0</span>
    <span id="bulkCompleteTime_echo" style="display:none;">0</span>
    <span id="FLOAT_DURATION_echo" style="display:none;">0</span>
    <span id="AutoShuntGainCorrection_echo" style="display:none;">0</span>
    <span id="AutoAltCurrentZero_echo" style="display:none;">0</span>
    <span id="WindingTempOffset_echo" style="display:none;">0</span>
    <span id="PulleyRatio_echo" style="display:none;">0</span>
    <span id="ManualLifePercentage_echo" style="display:none;">0</span>
    <span id="LastSessionDurationID" style="display:none;">0</span>
    <span id="wifiReconnectsTotalID" style="display:none;">0</span>
    <span id="LastSessionMaxLoopTimeID" style="display:none;">0</span>
    <span id="lastSessionMinHeapID" style="display:none;">0</span>
    <span id="CurrentSessionDurationID" style="display:none;">0</span>
    <span id="LastResetReasonID" style="display:none;">0</span>
    <span id="ancientResetReasonID" style="display:none;">0</span>
    <span id="totalPowerCyclesID" style="display:none;">0</span>
    <span id="totalPowerCyclesID" style="display:none;">0</span>
    <span id="BatteryCurrentSource_echo" style="display:none;">0</span>
    <span id="timeAxisModeChanging_echo" style="display:none;">0</span>
    <span id="webgaugesinterval_echo" style="display:none;">0</span>
    <span id="plotTimeWindow_echo" style="display:none;">0</span>
    <span id="weatherModeEnabled_echo" style="display:none;">0</span>
    <span id="SolarWatts_echo" style="display:none;">0</span>
    <span id="performanceRatio_echo" style="display:none;">0</span>
    <span id="UVThresholdHigh_echo" style="display:none;">0</span>
    <span id="pKwHrToday_ID" style="display:none;">0</span>
    <span id="pKwHrTomorrow_ID" style="display:none;">0</span>
    <span id="pKwHr2days_ID" style="display:none;">0</span>
    <span id="WifiStrengthID" style="display:none;">0</span>
    <span id="WifiHeartBeatID" style="display:none;">0</span>
    <span id="LoopTimeID" style="display:none;">0</span>
    <span id="baroPressureID" style="display:none;">0</span>
    <span id="ambientTempID" style="display:none;">0</span>
    <span id="firmwareVersionIntID" style="display:none;"></span>
    <span id="deviceIdUpperID" style="display:none;"></span>
    <span id="deviceIdLowerID" style="display:none;"></span>
    <span id="LearningRPMChangeThreshold_display" style="display:none;">0</span>
    <span id="LearningTempHysteresis_display" style="display:none;">0</span>



    <!-- Input id's are for User input aka Settings
 Form submission - values that get sent to the server
 Two-way data binding - both read and write -->
    <input id="TemperatureLimitF" style="display:none;" value="0" />
    <input id="BulkVoltage" style="display:none;" value="0" />
    <input id="TargetAmps" style="display:none;" value="0" />
    <input id="FloatVoltage" style="display:none;" value="0" />
    <input id="SwitchingFrequency" style="display:none;" value="0" />
    <input id="dutyStep" style="display:none;" value="0" />
    <input id="FieldAdjustmentInterval" style="display:none;" value="0" />
    <input id="ManualDutyTarget" style="display:none;" value="0" />
    <input id="SwitchControlOverride" name="SwitchControlOverride" type="number" value style="display:none;" />
    <input id="ManualFieldToggle" name="ManualFieldToggle" type="number" value style="display:none;" />
    <input id="HiLow" name="HiLow" type="number" value style="display:none;" />
    <input id="LimpHome" name="LimpHome" type="number" value style="display:none;" />
    <input id="VeData" name="VeData" type="number" value style="display:none;" />
    <input id="NMEA0183Data" name="NMEA0183Data" type="number" value style="display:none;" />
    <input id="NMEA2KData" name="NMEA2KData" type="number" value style="display:none;" />
    <input id="TargetAmpL" style="display:none;" value="0" />
    <input id="CurrentThreshold" style="display:none;" value="0" />
    <input id="PeukertExponent" style="display:none;" value="0" />
    <input id="ChargeEfficiency" style="display:none;" value="0" />
    <input id="ChargedVoltage" style="display:none;" value="0" />
    <input id="TailCurrent" style="display:none;" value="0" />
    <input id="ChargedDetectionTime" style="display:none;" value="0" />
    <input id="IgnoreTemperature" name="IgnoreTemperature" type="number" value style="display:none;" />
    <input id="bmsLogic" name="bmsLogic" type="number" value style="display:none;" />
    <input id="bmsLogicLevelOff" name="bmsLogicLevelOff" type="number" value style="display:none;" />
    <input id="AlarmActivate" name="AlarmActivate" type="number" value style="display:none;" />
    <input id="TempAlarm" style="display:none;" value="0" />
    <input id="VoltageAlarmHigh" style="display:none;" value="0" />
    <input id="VoltageAlarmLow" style="display:none;" value="0" />
    <input id="CurrentAlarmHigh" style="display:none;" value="0" />
    <input id="FourWay" style="display:none;" value="0" />
    <input id="RPMScalingFactor" style="display:none;" value="0" />
    <input id="weatherModeEnabled" name="weatherModeEnabled" type="number" value style="display:none;" />

    <input type="hidden" name="ResetTemp" id="ResetTemp" value="0" />
    <input type="hidden" name="ResetVoltage" id="ResetVoltage" value="0" />
    <input type="hidden" name="ResetCurrent" id="ResetCurrent" value="0" />
    <input type="hidden" name="ResetEngineRunTime" id="ResetEngineRunTime" value="0" />
    <input type="hidden" name="ResetAlternatorOnTime" id="ResetAlternatorOnTime" value="0" />
    <input type="hidden" name="ResetEnergy" id="ResetEnergy" value="0" />
    <input type="hidden" name="ResetAlternatorChargedEnergy" id="ResetAlternatorChargedEnergy" value="0" />
    <input type="hidden" name="ResetDischargedEnergy" id="ResetDischargedEnergy" value="0" />
    <input type="hidden" name="ResetFuelUsed" id="ResetFuelUsed" value="0" />
    <input type="hidden" name="ResetEngineCycles" id="ResetEngineCycles" value="0" />
    <input type="hidden" name="ResetRPMMax" id="ResetRPMMax" value="0" />
    <input id="MaximumAllowedBatteryAmps" style="display:none;" value="0" />
    <input id="ManualSOCPoint" style="display:none;" value="0" />
    <input id="BatteryVoltageSource" style="display:none;" value="0" />
    <input id="AmpSrc" style="display:none;" value="0" />
    <input id="ShuntResistanceMicroOhm" style="display:none;" value="0" />
    <input id="InvertAltAmps" name="InvertAltAmps" type="number" value style="display:none;" />
    <input id="InvertBattAmps" name="InvertBattAmps" type="number" value style="display:none;" />
    <input id="MaxDuty" style="display:none;" value="0" />
    <input id="MinDuty" style="display:none;" value="0" />
    <input id="FieldResistance" style="display:none;" value="0" />
    <input id="maxPoints" style="display:none;" value="0" />
    <input id="AlternatorCOffset" style="display:none;" value="0" />
    <input id="BatteryCOffset" style="display:none;" value="0" />
    <input id="BatteryCapacity_Ah" style="display:none;" value="0" />
    <input id="R_fixed" style="display:none;" value="0" />
    <input id="Beta" style="display:none;" value="0" />
    <input id="T0_C" style="display:none;" value="0" />
    <input id="TempSource" name="TempSource" type="number" value style="display:none;" />
    <input id="IgnitionOverride" name="IgnitionOverride" type="number" value style="display:none;" />
    <input id="AlarmLatchEnabled" name="AlarmLatchEnabled" type="number" value style="display:none;" />
    <input id="AlarmTest" style="display:none;" value="0" />
    <input id="ResetAlarmLatch" style="display:none;" value="0" />
    <input id="ForceFloat" name="ForceFloat" type="number" value style="display:none;" />
    <input id="bulkCompleteTime" style="display:none;" value="0" />
    <input id="FLOAT_DURATION" style="display:none;" value="0" />
    <input id="AutoShuntGainCorrection" name="AutoShuntGainCorrection" type="number" value style="display:none;" />
    <input id="AutoAltCurrentZero" name="AutoAltCurrentZero" type="number" value style="display:none;" />
    <input id="WindingTempOffset" style="display:none;" value="50.0" />
    <input id="PulleyRatio" style="display:none;" value="2.00" />
    <input id="ManualLifePercentage" style="display:none;" value="100" />
    <input id="BatteryCurrentSource" style="display:none;" value="0" />
    <input id="timeAxisModeChanging" name="timeAxisModeChanging" type="number" value style="display:none;" />
    <input id="webgaugesinterval" style="display:none;" value="0" />
    <input id="plotTimeWindow" style="display:none;" value="0" />
    <input id="SolarWatts" style="display:none;" value="0" />
    <input id="performanceRatio" style="display:none;" value="0" />
    <input id="LearningMode" name="LearningMode" type="number" value="" style="display:none;" />
    <input id="LearningPaused" name="LearningPaused" type="number" value="" style="display:none;" />
    <input id="LearningDryRunMode" name="LearningDryRunMode" type="number" value="" style="display:none;" />
    <input id="LearningUpwardEnabled" name="LearningUpwardEnabled" type="number" value="" style="display:none;" />
    <input id="LearningDownwardEnabled" name="LearningDownwardEnabled" type="number" value="" style="display:none;" />
    <input id="EnableNeighborLearning" name="EnableNeighborLearning" type="number" value="" style="display:none;" />
    <input id="AutoSaveLearningTable" name="AutoSaveLearningTable" type="number" value="" style="display:none;" />
    <input id="ShowLearningDebugMessages" name="ShowLearningDebugMessages" type="number" value=""
      style="display:none;" />
    <input id="AlternatorNominalAmps" style="display:none;" value="0" />
    <input id="LearningUpStep" style="display:none;" value="0" />
    <input id="LearningDownStep" style="display:none;" value="0" />
    <input id="MinLearningInterval" style="display:none;" value="0" />
    <input id="SafeOperationThreshold" style="display:none;" value="0" />
    <input id="PidKp" style="display:none;" value="0" />
    <input id="PidKi" style="display:none;" value="0" />
    <input id="PidKd" style="display:none;" value="0" />
    <input id="PidSampleTime" style="display:none;" value="0" />
    <input type="hidden" id="EXTRA" name="EXTRA" value="0">


  </div>
</body>

</html>
<!-- XREG_END -->